{
  "version": 3,
  "sources": ["../src/index.ts", "../src/config.ts", "../src/services/api.ts", "../node_modules/marked/src/defaults.ts", "../node_modules/marked/src/rules.ts", "../node_modules/marked/src/helpers.ts", "../node_modules/marked/src/Tokenizer.ts", "../node_modules/marked/src/Lexer.ts", "../node_modules/marked/src/Renderer.ts", "../node_modules/marked/src/TextRenderer.ts", "../node_modules/marked/src/Parser.ts", "../node_modules/marked/src/Hooks.ts", "../node_modules/marked/src/Instance.ts", "../node_modules/marked/src/marked.ts", "../src/services/dom.ts", "../src/services/markdown.ts", "../src/services/session.ts", "../src/services/page-context.ts", "../src/components/avatar.ts", "../src/components/panel.ts", "../src/components/message.ts", "../src/components/input.ts", "../src/styles/variables.ts"],
  "sourcesContent": ["/**\r\n * AI Chat Widget - Main Entry Point\r\n *\r\n * A lightweight, embeddable chat widget with SSE streaming support.\r\n */\r\n\r\nimport type {\r\n  ChatWidgetConfig,\r\n  PartialConfig,\r\n  Message,\r\n  SSEEvent,\r\n  SSETextEvent,\r\n  SSEToolCallEvent,\r\n  SSEToolResultEvent,\r\n  ChatWidgetAPI,\r\n  ToolCall,\r\n} from './types';\r\nimport { mergeConfig, validateConfig } from './config';\r\nimport { ApiService } from './services/api';\r\nimport { MarkdownService } from './services/markdown';\r\nimport { SessionService } from './services/session';\r\nimport { PageContextService } from './services/page-context';\r\nimport {\r\n  createContainer,\r\n  injectStyles,\r\n  destroyWidget,\r\n  generateId,\r\n  announceToScreenReader,\r\n} from './services/dom';\r\nimport { AvatarComponent } from './components/avatar';\r\nimport { PanelComponent } from './components/panel';\r\nimport { MessageComponent } from './components/message';\r\nimport { InputComponent } from './components/input';\r\nimport { generateStyles } from './styles/variables';\r\n\r\nexport class ChatWidget implements ChatWidgetAPI {\r\n  private config: ChatWidgetConfig;\r\n  private apiService: ApiService;\r\n  private markdownService: MarkdownService;\r\n  private sessionService: SessionService;\r\n  private pageContextService: PageContextService;\r\n\r\n  private container: HTMLElement | null = null;\r\n  private avatar: AvatarComponent | null = null;\r\n  private panel: PanelComponent | null = null;\r\n  private input: InputComponent | null = null;\r\n\r\n  private messageComponents: Map<string, MessageComponent> = new Map();\r\n  private isOpen: boolean = false;\r\n  private isStreaming: boolean = false;\r\n  private currentStreamingMessage: Message | null = null;\r\n\r\n  constructor(userConfig: PartialConfig) {\r\n    // Validate configuration\r\n    const errors = validateConfig(userConfig);\r\n    if (errors.length > 0) {\r\n      console.error('[ChatWidget] Configuration errors:', errors);\r\n      throw new Error(`ChatWidget configuration invalid: ${errors.join(', ')}`);\r\n    }\r\n\r\n    // Merge with defaults\r\n    this.config = mergeConfig(userConfig);\r\n\r\n    // Initialize services\r\n    this.apiService = new ApiService(this.config);\r\n    this.markdownService = new MarkdownService(this.config);\r\n    this.sessionService = new SessionService(this.config);\r\n    this.pageContextService = new PageContextService(this.config);\r\n  }\r\n\r\n  /**\r\n   * Initialize and mount the widget\r\n   */\r\n  init(): void {\r\n    // Create container and inject styles\r\n    this.container = createContainer();\r\n    injectStyles(generateStyles(this.config));\r\n\r\n    // Initialize session\r\n    const session = this.sessionService.initialize();\r\n\r\n    // Create avatar component\r\n    this.avatar = new AvatarComponent({\r\n      imageUrl: this.config.avatarImage,\r\n      size: this.config.avatarSize,\r\n      position: this.config.position,\r\n      primaryColor: this.config.primaryColor,\r\n      onClick: () => this.toggle(),\r\n    });\r\n\r\n    // Create panel component\r\n    this.panel = new PanelComponent({\r\n      title: this.config.headerTitle,\r\n      width: this.config.chatWidth,\r\n      height: this.config.chatHeight,\r\n      position: this.config.position,\r\n      primaryColor: this.config.primaryColor,\r\n      pushContent: this.config.pushContent,\r\n      onClose: () => this.close(),\r\n      onMinimize: () => this.close(),\r\n      onClearHistory: () => this.clearHistory(),\r\n    });\r\n\r\n    // Create input component\r\n    this.input = new InputComponent({\r\n      placeholder: this.config.placeholder,\r\n      primaryColor: this.config.primaryColor,\r\n      onSend: (message) => this.sendMessage(message),\r\n    });\r\n\r\n    // Mount components\r\n    this.container.appendChild(this.avatar.getElement());\r\n    this.container.appendChild(this.panel.getElement());\r\n    this.panel.mountInput(this.input);\r\n\r\n    // Set welcome message\r\n    if (this.config.welcomeMessage) {\r\n      this.panel.setWelcomeMessage(this.config.welcomeMessage);\r\n    }\r\n\r\n    // Restore messages from session\r\n    session.messages.forEach((msg) => this.renderMessage(msg));\r\n\r\n    // Open on load if configured\r\n    if (this.config.openOnLoad) {\r\n      this.open();\r\n    }\r\n\r\n    // Expose public API\r\n    this.exposePublicAPI();\r\n\r\n    console.log('[ChatWidget] Initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Open the chat panel\r\n   */\r\n  open(): void {\r\n    if (this.isOpen || !this.panel || !this.avatar) return;\r\n\r\n    this.isOpen = true;\r\n    this.avatar.hide();\r\n    this.avatar.setOpen(true);\r\n    this.panel.open();\r\n\r\n    // Focus input after animation\r\n    setTimeout(() => {\r\n      this.input?.focus();\r\n    }, 300);\r\n\r\n    // Call callback\r\n    this.config.onOpen?.();\r\n\r\n    announceToScreenReader('Chat opened');\r\n  }\r\n\r\n  /**\r\n   * Close the chat panel\r\n   */\r\n  close(): void {\r\n    if (!this.isOpen || !this.panel || !this.avatar) return;\r\n\r\n    this.isOpen = false;\r\n    this.panel.close();\r\n    this.avatar.show();\r\n    this.avatar.setOpen(false);\r\n\r\n    // Call callback\r\n    this.config.onClose?.();\r\n\r\n    announceToScreenReader('Chat closed');\r\n  }\r\n\r\n  /**\r\n   * Toggle the chat panel\r\n   */\r\n  toggle(): void {\r\n    if (this.isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send a message\r\n   */\r\n  async sendMessage(content: string): Promise<void> {\r\n    if (this.isStreaming || !content.trim()) return;\r\n\r\n    // Create and render user message\r\n    const userMessage = this.sessionService.createUserMessage(content);\r\n    this.sessionService.addMessage(userMessage);\r\n    this.renderMessage(userMessage);\r\n\r\n    // Call callback\r\n    this.config.onMessageSent?.(userMessage);\r\n\r\n    // Create assistant message placeholder\r\n    const assistantMessage = this.sessionService.createAssistantMessage();\r\n    this.sessionService.addMessage(assistantMessage);\r\n    this.renderMessage(assistantMessage);\r\n\r\n    this.currentStreamingMessage = assistantMessage;\r\n\r\n    // Start streaming\r\n    this.isStreaming = true;\r\n    this.input?.disable();\r\n    this.input?.showTyping();\r\n\r\n    // Extract page context if enabled\r\n    const pageContext = this.pageContextService.extractContext();\r\n\r\n    try {\r\n      await this.apiService.streamMessage(\r\n        content,\r\n        this.sessionService.getConversationId(),\r\n        (event) => this.handleSSEEvent(event),\r\n        () => this.handleStreamComplete(),\r\n        (error) => this.handleStreamError(error),\r\n        pageContext\r\n      );\r\n    } catch (error) {\r\n      this.handleStreamError(error as Error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle SSE events\r\n   */\r\n  private handleSSEEvent(event: SSEEvent): void {\r\n    if (!this.currentStreamingMessage) return;\r\n\r\n    const component = this.messageComponents.get(this.currentStreamingMessage.id);\r\n    if (!component) return;\r\n\r\n    switch (event.type) {\r\n      case 'start':\r\n        // Stream started\r\n        break;\r\n\r\n      case 'text': {\r\n        const textEvent = event as SSETextEvent;\r\n        const newContent = this.currentStreamingMessage.content + (textEvent.content || '');\r\n        this.currentStreamingMessage.content = newContent;\r\n        component.updateContent(newContent, false);\r\n        this.panel?.scrollToBottom();\r\n        break;\r\n      }\r\n\r\n      case 'tool-call': {\r\n        const toolEvent = event as SSEToolCallEvent;\r\n        const toolCall: ToolCall = {\r\n          id: toolEvent.content?.toolCallId || generateId(),\r\n          toolName: toolEvent.content?.toolName || 'unknown',\r\n          args: toolEvent.content?.args,\r\n          status: 'pending',\r\n        };\r\n        component.addToolCall(toolCall);\r\n        break;\r\n      }\r\n\r\n      case 'tool-result': {\r\n        const resultEvent = event as SSEToolResultEvent;\r\n        if (resultEvent.content?.toolCallId) {\r\n          component.updateToolCall(resultEvent.content.toolCallId, {\r\n            result: resultEvent.content.result,\r\n            status: 'complete',\r\n          });\r\n        }\r\n        break;\r\n      }\r\n\r\n      case 'error': {\r\n        this.currentStreamingMessage.status = 'error';\r\n        component.setStatus('error');\r\n        const errorContent = (event.content as { message?: string })?.message || 'An error occurred';\r\n        component.showError(errorContent);\r\n        break;\r\n      }\r\n\r\n      case 'done':\r\n      case 'finish':\r\n        // Will be handled by handleStreamComplete\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle stream completion\r\n   */\r\n  private handleStreamComplete(): void {\r\n    if (this.currentStreamingMessage) {\r\n      this.currentStreamingMessage.status = 'complete';\r\n\r\n      const component = this.messageComponents.get(this.currentStreamingMessage.id);\r\n      if (component) {\r\n        component.updateContent(this.currentStreamingMessage.content, true);\r\n        component.setStatus('complete');\r\n      }\r\n\r\n      // Update session\r\n      this.sessionService.updateMessage(this.currentStreamingMessage.id, {\r\n        content: this.currentStreamingMessage.content,\r\n        status: 'complete',\r\n      });\r\n\r\n      // Call callback\r\n      this.config.onMessageReceived?.(this.currentStreamingMessage);\r\n\r\n      announceToScreenReader('New message received');\r\n    }\r\n\r\n    this.cleanupStreaming();\r\n  }\r\n\r\n  /**\r\n   * Handle stream error\r\n   */\r\n  private handleStreamError(error: Error): void {\r\n    console.error('[ChatWidget] Stream error:', error);\r\n\r\n    if (this.currentStreamingMessage) {\r\n      this.currentStreamingMessage.status = 'error';\r\n      this.currentStreamingMessage.content = 'Sorry, something went wrong. Please try again.';\r\n\r\n      const component = this.messageComponents.get(this.currentStreamingMessage.id);\r\n      if (component) {\r\n        component.updateContent(this.currentStreamingMessage.content, true);\r\n        component.setStatus('error');\r\n      }\r\n\r\n      this.sessionService.updateMessage(this.currentStreamingMessage.id, {\r\n        content: this.currentStreamingMessage.content,\r\n        status: 'error',\r\n      });\r\n    }\r\n\r\n    // Call callback\r\n    this.config.onError?.(error);\r\n\r\n    this.cleanupStreaming();\r\n  }\r\n\r\n  /**\r\n   * Clean up after streaming\r\n   */\r\n  private cleanupStreaming(): void {\r\n    this.isStreaming = false;\r\n    this.currentStreamingMessage = null;\r\n    this.input?.hideTyping();\r\n    this.input?.enable();\r\n    this.input?.focus();\r\n  }\r\n\r\n  /**\r\n   * Render a message\r\n   */\r\n  private renderMessage(message: Message): void {\r\n    const component = new MessageComponent(message, this.markdownService);\r\n    this.messageComponents.set(message.id, component);\r\n    this.panel?.addMessage(component.getElement());\r\n  }\r\n\r\n  /**\r\n   * Clear chat history\r\n   */\r\n  clearHistory(): void {\r\n    this.sessionService.clear();\r\n    this.messageComponents.clear();\r\n    this.panel?.clearMessages();\r\n\r\n    if (this.config.welcomeMessage) {\r\n      this.panel?.setWelcomeMessage(this.config.welcomeMessage);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroy the widget\r\n   */\r\n  destroy(): void {\r\n    // Abort any pending requests\r\n    this.apiService.abort();\r\n\r\n    // Close panel\r\n    if (this.isOpen) {\r\n      this.close();\r\n    }\r\n\r\n    // Destroy components\r\n    this.avatar?.destroy();\r\n    this.panel?.destroy();\r\n    this.input?.destroy();\r\n    this.messageComponents.clear();\r\n\r\n    // Remove from DOM\r\n    destroyWidget();\r\n\r\n    // Clean up global API\r\n    if (typeof window !== 'undefined') {\r\n      delete (window as unknown as Record<string, unknown>).ChatWidget;\r\n    }\r\n\r\n    console.log('[ChatWidget] Destroyed');\r\n  }\r\n\r\n  /**\r\n   * Expose public API on window\r\n   */\r\n  private exposePublicAPI(): void {\r\n    if (typeof window !== 'undefined') {\r\n      window.ChatWidget = {\r\n        open: () => this.open(),\r\n        close: () => this.close(),\r\n        toggle: () => this.toggle(),\r\n        sendMessage: (text: string) => this.sendMessage(text),\r\n        clearHistory: () => this.clearHistory(),\r\n        destroy: () => this.destroy(),\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n// Auto-initialize if config is present\r\nif (typeof window !== 'undefined') {\r\n  // Export class for manual initialization\r\n  (window as unknown as Record<string, unknown>).ChatWidget = ChatWidget;\r\n\r\n  // Auto-init when DOM is ready if config exists\r\n  const autoInit = (): void => {\r\n    if (window.ChatWidgetConfig) {\r\n      try {\r\n        const widget = new ChatWidget(window.ChatWidgetConfig);\r\n        widget.init();\r\n      } catch (error) {\r\n        console.error('[ChatWidget] Auto-initialization failed:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', autoInit);\r\n  } else {\r\n    // DOM already loaded, but use setTimeout to allow config script to execute\r\n    setTimeout(autoInit, 0);\r\n  }\r\n}\r\n\r\n// Export types and classes for module usage\r\nexport type { ChatWidgetConfig, PartialConfig, Message, ChatWidgetAPI } from './types';\r\nexport { mergeConfig, validateConfig } from './config';\r\n", "/**\r\n * Configuration defaults and validation\r\n */\r\n\r\nimport type { ChatWidgetConfig, PartialConfig } from './types';\r\n\r\n/**\r\n * Default configuration values\r\n */\r\nexport const defaultConfig: Omit<ChatWidgetConfig, 'agentEndpoint'> = {\r\n  // Positioning\r\n  position: 'bottom-right',\r\n  avatarSize: 60,\r\n  primaryColor: '#0066cc',\r\n  chatWidth: 400,\r\n  chatHeight: 600,\r\n\r\n  // Branding\r\n  headerTitle: 'Chat with Us',\r\n  welcomeMessage: 'Hello! How can I help you today?',\r\n  placeholder: 'Type your message...',\r\n\r\n  // Behavior\r\n  openOnLoad: false,\r\n  persistSession: true,\r\n  sessionStorageKey: 'chat-widget-session',\r\n  pushContent: true,\r\n  includePageContext: false,\r\n  pageContextSelector: null,\r\n\r\n  // Markdown\r\n  enableMarkdown: true,\r\n  syntaxHighlighting: true,\r\n  syntaxTheme: 'github-dark',\r\n\r\n  // Authentication\r\n  authToken: null,\r\n  authHeader: 'Authorization',\r\n};\r\n\r\n/**\r\n * Merge user config with defaults\r\n */\r\nexport function mergeConfig(userConfig: PartialConfig): ChatWidgetConfig {\r\n  return {\r\n    ...defaultConfig,\r\n    ...userConfig,\r\n  };\r\n}\r\n\r\n/**\r\n * Validate configuration\r\n */\r\nexport function validateConfig(config: PartialConfig): string[] {\r\n  const errors: string[] = [];\r\n\r\n  if (!config.agentEndpoint) {\r\n    errors.push('agentEndpoint is required');\r\n  } else {\r\n    try {\r\n      new URL(config.agentEndpoint);\r\n    } catch {\r\n      errors.push('agentEndpoint must be a valid URL');\r\n    }\r\n  }\r\n\r\n  if (config.avatarSize !== undefined && (config.avatarSize < 30 || config.avatarSize > 120)) {\r\n    errors.push('avatarSize must be between 30 and 120');\r\n  }\r\n\r\n  if (config.chatWidth !== undefined && (config.chatWidth < 280 || config.chatWidth > 800)) {\r\n    errors.push('chatWidth must be between 280 and 800');\r\n  }\r\n\r\n  if (config.chatHeight !== undefined && config.chatHeight !== 'full') {\r\n    if (typeof config.chatHeight === 'number' && (config.chatHeight < 300 || config.chatHeight > 1200)) {\r\n      errors.push('chatHeight must be between 300 and 1200, or \"full\"');\r\n    }\r\n  }\r\n\r\n  if (config.position !== undefined && !['bottom-right', 'bottom-left'].includes(config.position)) {\r\n    errors.push('position must be \"bottom-right\" or \"bottom-left\"');\r\n  }\r\n\r\n  if (config.syntaxTheme !== undefined && !['github-dark', 'github-light', 'monokai'].includes(config.syntaxTheme)) {\r\n    errors.push('syntaxTheme must be \"github-dark\", \"github-light\", or \"monokai\"');\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Parse color to ensure it's valid\r\n */\r\nexport function parseColor(color: string): string {\r\n  // Simple validation - just return the color if it looks valid\r\n  if (/^#[0-9A-Fa-f]{3,8}$/.test(color) || /^(rgb|hsl)a?\\(/.test(color)) {\r\n    return color;\r\n  }\r\n  // Return default if invalid\r\n  return defaultConfig.primaryColor;\r\n}\r\n", "/**\r\n * API service for agent communication with SSE streaming support\r\n */\r\n\r\nimport type { ChatWidgetConfig, SSEEvent, ChatRequest } from '../types';\r\n\r\nexport class ApiService {\r\n  private config: ChatWidgetConfig;\r\n  private abortController: AbortController | null = null;\r\n\r\n  constructor(config: ChatWidgetConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  /**\r\n   * Stream a message to the agent and receive SSE events\r\n   */\r\n  async streamMessage(\r\n    message: string,\r\n    conversationId: string | undefined,\r\n    onChunk: (event: SSEEvent) => void,\r\n    onComplete: () => void,\r\n    onError: (error: Error) => void,\r\n    pageContext?: string | null\r\n  ): Promise<void> {\r\n    this.abortController = new AbortController();\r\n\r\n    // Build the streaming endpoint URL\r\n    const url = this.buildStreamUrl();\r\n    const headers = this.buildHeaders();\r\n    const body: ChatRequest = {\r\n      message,\r\n      conversationId,\r\n      metadata: pageContext ? { pageContext } : {},\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(url, {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body),\r\n        signal: this.abortController.signal,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);\r\n      }\r\n\r\n      const reader = response.body?.getReader();\r\n      if (!reader) {\r\n        throw new Error('Response body is not readable');\r\n      }\r\n\r\n      const decoder = new TextDecoder();\r\n      let buffer = '';\r\n\r\n      while (true) {\r\n        const { done, value } = await reader.read();\r\n\r\n        if (done) {\r\n          // Process any remaining buffer content\r\n          if (buffer.trim()) {\r\n            this.processSSELines(buffer, onChunk);\r\n          }\r\n          break;\r\n        }\r\n\r\n        // Decode the chunk and add to buffer\r\n        buffer += decoder.decode(value, { stream: true });\r\n\r\n        // Split on newlines and process complete lines\r\n        const lines = buffer.split('\\n');\r\n        // Keep the last (potentially incomplete) line in the buffer\r\n        buffer = lines.pop() || '';\r\n\r\n        // Process complete lines\r\n        const completeData = lines.join('\\n');\r\n        this.processSSELines(completeData, onChunk);\r\n      }\r\n\r\n      onComplete();\r\n    } catch (error) {\r\n      if ((error as Error).name === 'AbortError') {\r\n        // Request was aborted, don't call onError\r\n        return;\r\n      }\r\n      onError(error as Error);\r\n    } finally {\r\n      this.abortController = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process SSE lines and emit events\r\n   */\r\n  private processSSELines(data: string, onChunk: (event: SSEEvent) => void): void {\r\n    const lines = data.split('\\n');\r\n\r\n    for (const line of lines) {\r\n      const trimmedLine = line.trim();\r\n\r\n      // Skip empty lines and comments\r\n      if (!trimmedLine || trimmedLine.startsWith(':')) {\r\n        continue;\r\n      }\r\n\r\n      // Parse SSE data line\r\n      if (trimmedLine.startsWith('data: ')) {\r\n        const jsonStr = trimmedLine.slice(6);\r\n\r\n        if (jsonStr === '[DONE]') {\r\n          // OpenAI-style completion marker\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          const event = JSON.parse(jsonStr) as SSEEvent;\r\n          onChunk(event);\r\n        } catch (e) {\r\n          console.warn('[ChatWidget] Failed to parse SSE event:', jsonStr, e);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Abort the current streaming request\r\n   */\r\n  abort(): void {\r\n    if (this.abortController) {\r\n      this.abortController.abort();\r\n      this.abortController = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a request is currently in progress\r\n   */\r\n  isStreaming(): boolean {\r\n    return this.abortController !== null;\r\n  }\r\n\r\n  /**\r\n   * Build the streaming endpoint URL\r\n   */\r\n  private buildStreamUrl(): string {\r\n    const baseUrl = this.config.agentEndpoint;\r\n\r\n    // If the endpoint already ends with /stream, use as-is\r\n    if (baseUrl.endsWith('/stream')) {\r\n      return baseUrl;\r\n    }\r\n\r\n    // Otherwise, append /stream\r\n    return baseUrl.endsWith('/') ? `${baseUrl}stream` : `${baseUrl}/stream`;\r\n  }\r\n\r\n  /**\r\n   * Build request headers\r\n   */\r\n  private buildHeaders(): HeadersInit {\r\n    const headers: HeadersInit = {\r\n      'Content-Type': 'application/json',\r\n      Accept: 'text/event-stream',\r\n    };\r\n\r\n    // Add authentication if configured\r\n    if (this.config.authToken) {\r\n      if (this.config.authHeader === 'Authorization') {\r\n        // Bearer token format\r\n        headers['Authorization'] = `Bearer ${this.config.authToken}`;\r\n      } else {\r\n        // Custom header\r\n        headers[this.config.authHeader] = this.config.authToken;\r\n      }\r\n    }\r\n\r\n    return headers;\r\n  }\r\n\r\n  /**\r\n   * Send a non-streaming message (fallback)\r\n   */\r\n  async sendMessage(message: string, conversationId?: string): Promise<SSEEvent[]> {\r\n    const url = this.config.agentEndpoint.replace(/\\/stream$/, '/chat');\r\n    const headers = this.buildHeaders() as Record<string, string>;\r\n    headers['Accept'] = 'application/json';\r\n\r\n    const body: ChatRequest = {\r\n      message,\r\n      conversationId,\r\n      metadata: {},\r\n    };\r\n\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers,\r\n      body: JSON.stringify(body),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // Convert non-streaming response to SSE event format\r\n    const events: SSEEvent[] = [\r\n      { type: 'start' },\r\n      { type: 'text', content: result.data?.text || result.text || '' },\r\n      { type: 'finish' },\r\n    ];\r\n\r\n    return events;\r\n  }\r\n}\r\n", "import type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Gets the original marked default options.\n */\nexport function _getDefaults(): MarkedOptions {\n  return {\n    async: false,\n    breaks: false,\n    extensions: null,\n    gfm: true,\n    hooks: null,\n    pedantic: false,\n    renderer: null,\n    silent: false,\n    tokenizer: null,\n    walkTokens: null,\n  };\n}\n\nexport let _defaults = _getDefaults();\n\nexport function changeDefaults(newDefaults: MarkedOptions) {\n  _defaults = newDefaults;\n}\n", "const noopTest = { exec: () => null } as unknown as RegExp;\n\nfunction edit(regex: string | RegExp, opt = '') {\n  let source = typeof regex === 'string' ? regex : regex.source;\n  const obj = {\n    replace: (name: string | RegExp, val: string | RegExp) => {\n      let valSource = typeof val === 'string' ? val : val.source;\n      valSource = valSource.replace(other.caret, '$1');\n      source = source.replace(name, valSource);\n      return obj;\n    },\n    getRegex: () => {\n      return new RegExp(source, opt);\n    },\n  };\n  return obj;\n}\n\nexport const other = {\n  codeRemoveIndent: /^(?: {1,4}| {0,3}\\t)/gm,\n  outputLinkReplace: /\\\\([\\[\\]])/g,\n  indentCodeCompensation: /^(\\s+)(?:```)/,\n  beginningSpace: /^\\s+/,\n  endingHash: /#$/,\n  startingSpaceChar: /^ /,\n  endingSpaceChar: / $/,\n  nonSpaceChar: /[^ ]/,\n  newLineCharGlobal: /\\n/g,\n  tabCharGlobal: /\\t/g,\n  multipleSpaceGlobal: /\\s+/g,\n  blankLine: /^[ \\t]*$/,\n  doubleBlankLine: /\\n[ \\t]*\\n[ \\t]*$/,\n  blockquoteStart: /^ {0,3}>/,\n  blockquoteSetextReplace: /\\n {0,3}((?:=+|-+) *)(?=\\n|$)/g,\n  blockquoteSetextReplace2: /^ {0,3}>[ \\t]?/gm,\n  listReplaceTabs: /^\\t+/,\n  listReplaceNesting: /^ {1,4}(?=( {4})*[^ ])/g,\n  listIsTask: /^\\[[ xX]\\] /,\n  listReplaceTask: /^\\[[ xX]\\] +/,\n  anyLine: /\\n.*\\n/,\n  hrefBrackets: /^<(.*)>$/,\n  tableDelimiter: /[:|]/,\n  tableAlignChars: /^\\||\\| *$/g,\n  tableRowBlankLine: /\\n[ \\t]*$/,\n  tableAlignRight: /^ *-+: *$/,\n  tableAlignCenter: /^ *:-+: *$/,\n  tableAlignLeft: /^ *:-+ *$/,\n  startATag: /^<a /i,\n  endATag: /^<\\/a>/i,\n  startPreScriptTag: /^<(pre|code|kbd|script)(\\s|>)/i,\n  endPreScriptTag: /^<\\/(pre|code|kbd|script)(\\s|>)/i,\n  startAngleBracket: /^</,\n  endAngleBracket: />$/,\n  pedanticHrefTitle: /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/,\n  unicodeAlphaNumeric: /[\\p{L}\\p{N}]/u,\n  escapeTest: /[&<>\"']/,\n  escapeReplace: /[&<>\"']/g,\n  escapeTestNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,\n  escapeReplaceNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/g,\n  unescapeTest: /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig,\n  caret: /(^|[^\\[])\\^/g,\n  percentDecode: /%25/g,\n  findPipe: /\\|/g,\n  splitPipe: / \\|/,\n  slashPipe: /\\\\\\|/g,\n  carriageReturn: /\\r\\n|\\r/g,\n  spaceLine: /^ +$/gm,\n  notSpaceStart: /^\\S*/,\n  endingNewline: /\\n$/,\n  listItemRegex: (bull: string) => new RegExp(`^( {0,3}${bull})((?:[\\t ][^\\\\n]*)?(?:\\\\n|$))`),\n  nextBulletRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \\t][^\\\\n]*)?(?:\\\\n|$))`),\n  hrRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),\n  fencesBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`),\n  headingBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`),\n  htmlBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}<(?:[a-z].*>|!--)`, 'i'),\n};\n\n/**\n * Block-Level Grammar\n */\n\nconst newline = /^(?:[ \\t]*(?:\\n|$))+/;\nconst blockCode = /^((?: {4}| {0,3}\\t)[^\\n]+(?:\\n(?:[ \\t]*(?:\\n|$))*)?)+/;\nconst fences = /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/;\nconst hr = /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/;\nconst heading = /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/;\nconst bullet = /(?:[*+-]|\\d{1,9}[.)])/;\nconst lheadingCore = /^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\\n(?!\\s*?\\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/;\nconst lheading = edit(lheadingCore)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .replace(/\\|table/g, '') // table not in commonmark\n  .getRegex();\nconst lheadingGfm = edit(lheadingCore)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .replace(/table/g, / {0,3}\\|?(?:[:\\- ]*\\|)+[\\:\\- ]*\\n/) // table can interrupt\n  .getRegex();\nconst _paragraph = /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/;\nconst blockText = /^[^\\n]+/;\nconst _blockLabel = /(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;\nconst def = edit(/^ {0,3}\\[(label)\\]: *(?:\\n[ \\t]*)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n[ \\t]*)?| *\\n[ \\t]*)(title))? *(?:\\n+|$)/)\n  .replace('label', _blockLabel)\n  .replace('title', /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/)\n  .getRegex();\n\nconst list = edit(/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/)\n  .replace(/bull/g, bullet)\n  .getRegex();\n\nconst _tag = 'address|article|aside|base|basefont|blockquote|body|caption'\n  + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption'\n  + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe'\n  + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option'\n  + '|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title'\n  + '|tr|track|ul';\nconst _comment = /<!--(?:-?>|[\\s\\S]*?(?:-->|$))/;\nconst html = edit(\n  '^ {0,3}(?:' // optional indentation\n+ '<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n+ '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n+ '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n+ '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n+ '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n+ '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (6)\n+ '|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) open tag\n+ '|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) closing tag\n+ ')', 'i')\n  .replace('comment', _comment)\n  .replace('tag', _tag)\n  .replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst paragraph = edit(_paragraph)\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n  .replace('|table', '')\n  .replace('blockquote', ' {0,3}>')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockquote = edit(/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/)\n  .replace('paragraph', paragraph)\n  .getRegex();\n\n/**\n * Normal Block Grammar\n */\n\nconst blockNormal = {\n  blockquote,\n  code: blockCode,\n  def,\n  fences,\n  heading,\n  hr,\n  html,\n  lheading,\n  list,\n  newline,\n  paragraph,\n  table: noopTest,\n  text: blockText,\n};\n\ntype BlockKeys = keyof typeof blockNormal;\n\n/**\n * GFM Block Grammar\n */\n\nconst gfmTable = edit(\n  '^ *([^\\\\n ].*)\\\\n' // Header\n+ ' {0,3}((?:\\\\| *)?:?-+:? *(?:\\\\| *:?-+:? *)*(?:\\\\| *)?)' // Align\n+ '(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)') // Cells\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('blockquote', ' {0,3}>')\n  .replace('code', '(?: {4}| {0,3}\\t)[^\\\\n]')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockGfm: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  lheading: lheadingGfm,\n  table: gfmTable,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n    .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n    .replace('table', gfmTable) // interrupt paragraphs with table\n    .replace('blockquote', ' {0,3}>')\n    .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n    .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n    .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n    .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n    .getRegex(),\n};\n\n/**\n * Pedantic grammar (original John Gruber's loose markdown specification)\n */\n\nconst blockPedantic: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  html: edit(\n    '^ *(?:comment *(?:\\\\n|\\\\s*$)'\n    + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n    + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))')\n    .replace('comment', _comment)\n    .replace(/tag/g, '(?!(?:'\n      + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub'\n      + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)'\n      + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b')\n    .getRegex(),\n  def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n  heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n  fences: noopTest, // fences not supported\n  lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' *#{1,6} *[^\\n]')\n    .replace('lheading', lheading)\n    .replace('|table', '')\n    .replace('blockquote', ' {0,3}>')\n    .replace('|fences', '')\n    .replace('|list', '')\n    .replace('|html', '')\n    .replace('|tag', '')\n    .getRegex(),\n};\n\n/**\n * Inline-Level Grammar\n */\n\nconst escape = /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/;\nconst inlineCode = /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/;\nconst br = /^( {2,}|\\\\)\\n(?!\\s*$)/;\nconst inlineText = /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/;\n\n// list of unicode punctuation marks, plus any missing characters from CommonMark spec\nconst _punctuation = /[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpace = /[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpace = /[^\\s\\p{P}\\p{S}]/u;\nconst punctuation = edit(/^((?![*_])punctSpace)/, 'u')\n  .replace(/punctSpace/g, _punctuationOrSpace).getRegex();\n\n// GFM allows ~ inside strong and em for strikethrough\nconst _punctuationGfmStrongEm = /(?!~)[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpaceGfmStrongEm = /(?!~)[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpaceGfmStrongEm = /(?:[^\\s\\p{P}\\p{S}]|~)/u;\n\n// sequences em should skip over [title](link), `code`, <html>\nconst blockSkip = /\\[[^[\\]]*?\\]\\((?:\\\\.|[^\\\\\\(\\)]|\\((?:\\\\.|[^\\\\\\(\\)])*\\))*\\)|`[^`]*?`|<[^<>]*?>/g;\n\nconst emStrongLDelimCore = /^(?:\\*+(?:((?!\\*)punct)|[^\\s*]))|^_+(?:((?!_)punct)|([^\\s_]))/;\n\nconst emStrongLDelim = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongLDelimGfm = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\nconst emStrongRDelimAstCore =\n  '^[^_*]*?__[^_*]*?\\\\*[^_*]*?(?=__)' // Skip orphan inside strong\n+ '|[^*]+(?=[^*])' // Consume to delim\n+ '|(?!\\\\*)punct(\\\\*+)(?=[\\\\s]|$)' // (1) #*** can only be a Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?!\\\\*)(?=punctSpace|$)' // (2) a***#, a*** can only be a Right Delimiter\n+ '|(?!\\\\*)punctSpace(\\\\*+)(?=notPunctSpace)' // (3) #***a, ***a can only be Left Delimiter\n+ '|[\\\\s](\\\\*+)(?!\\\\*)(?=punct)' // (4) ***# can only be Left Delimiter\n+ '|(?!\\\\*)punct(\\\\*+)(?!\\\\*)(?=punct)' // (5) #***# can be either Left or Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?=notPunctSpace)'; // (6) a***a can be either Left or Right Delimiter\n\nconst emStrongRDelimAst = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongRDelimAstGfm = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpaceGfmStrongEm)\n  .replace(/punctSpace/g, _punctuationOrSpaceGfmStrongEm)\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\n// (6) Not allowed for _\nconst emStrongRDelimUnd = edit(\n  '^[^_*]*?\\\\*\\\\*[^_*]*?_[^_*]*?(?=\\\\*\\\\*)' // Skip orphan inside strong\n+ '|[^_]+(?=[^_])' // Consume to delim\n+ '|(?!_)punct(_+)(?=[\\\\s]|$)' // (1) #___ can only be a Right Delimiter\n+ '|notPunctSpace(_+)(?!_)(?=punctSpace|$)' // (2) a___#, a___ can only be a Right Delimiter\n+ '|(?!_)punctSpace(_+)(?=notPunctSpace)' // (3) #___a, ___a can only be Left Delimiter\n+ '|[\\\\s](_+)(?!_)(?=punct)' // (4) ___# can only be Left Delimiter\n+ '|(?!_)punct(_+)(?!_)(?=punct)', 'gu') // (5) #___# can be either Left or Right Delimiter\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst anyPunctuation = edit(/\\\\(punct)/, 'gu')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst autolink = edit(/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/)\n  .replace('scheme', /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/)\n  .replace('email', /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/)\n  .getRegex();\n\nconst _inlineComment = edit(_comment).replace('(?:-->|$)', '-->').getRegex();\nconst tag = edit(\n  '^comment'\n    + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>') // CDATA section\n  .replace('comment', _inlineComment)\n  .replace('attribute', /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst _inlineLabel = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\n\nconst link = edit(/^!?\\[(label)\\]\\(\\s*(href)(?:(?:[ \\t]*(?:\\n[ \\t]*)?)(title))?\\s*\\)/)\n  .replace('label', _inlineLabel)\n  .replace('href', /<(?:\\\\.|[^\\n<>\\\\])+>|[^ \\t\\n\\x00-\\x1f]*/)\n  .replace('title', /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/)\n  .getRegex();\n\nconst reflink = edit(/^!?\\[(label)\\]\\[(ref)\\]/)\n  .replace('label', _inlineLabel)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst nolink = edit(/^!?\\[(ref)\\](?:\\[\\])?/)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst reflinkSearch = edit('reflink|nolink(?!\\\\()', 'g')\n  .replace('reflink', reflink)\n  .replace('nolink', nolink)\n  .getRegex();\n\n/**\n * Normal Inline Grammar\n */\n\nconst inlineNormal = {\n  _backpedal: noopTest, // only used for GFM url\n  anyPunctuation,\n  autolink,\n  blockSkip,\n  br,\n  code: inlineCode,\n  del: noopTest,\n  emStrongLDelim,\n  emStrongRDelimAst,\n  emStrongRDelimUnd,\n  escape,\n  link,\n  nolink,\n  punctuation,\n  reflink,\n  reflinkSearch,\n  tag,\n  text: inlineText,\n  url: noopTest,\n};\n\ntype InlineKeys = keyof typeof inlineNormal;\n\n/**\n * Pedantic Inline Grammar\n */\n\nconst inlinePedantic: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  link: edit(/^!?\\[(label)\\]\\((.*?)\\)/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n  reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n};\n\n/**\n * GFM Inline Grammar\n */\n\nconst inlineGfm: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  emStrongRDelimAst: emStrongRDelimAstGfm,\n  emStrongLDelim: emStrongLDelimGfm,\n  url: edit(/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/, 'i')\n    .replace('email', /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/)\n    .getRegex(),\n  _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n  del: /^(~~?)(?=[^\\s~])((?:\\\\.|[^\\\\])*?(?:\\\\.|[^\\s~\\\\]))\\1(?=[^~]|$)/,\n  text: /^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/,\n};\n\n/**\n * GFM + Line Breaks Inline Grammar\n */\n\nconst inlineBreaks: Record<InlineKeys, RegExp> = {\n  ...inlineGfm,\n  br: edit(br).replace('{2,}', '*').getRegex(),\n  text: edit(inlineGfm.text)\n    .replace('\\\\b_', '\\\\b_| {2,}\\\\n')\n    .replace(/\\{2,\\}/g, '*')\n    .getRegex(),\n};\n\n/**\n * exports\n */\n\nexport const block = {\n  normal: blockNormal,\n  gfm: blockGfm,\n  pedantic: blockPedantic,\n};\n\nexport const inline = {\n  normal: inlineNormal,\n  gfm: inlineGfm,\n  breaks: inlineBreaks,\n  pedantic: inlinePedantic,\n};\n\nexport interface Rules {\n  other: typeof other\n  block: Record<BlockKeys, RegExp>\n  inline: Record<InlineKeys, RegExp>\n}\n", "import { other } from './rules.ts';\n\n/**\n * Helpers\n */\nconst escapeReplacements: { [index: string]: string } = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n};\nconst getEscapeReplacement = (ch: string) => escapeReplacements[ch];\n\nexport function escape(html: string, encode?: boolean) {\n  if (encode) {\n    if (other.escapeTest.test(html)) {\n      return html.replace(other.escapeReplace, getEscapeReplacement);\n    }\n  } else {\n    if (other.escapeTestNoEncode.test(html)) {\n      return html.replace(other.escapeReplaceNoEncode, getEscapeReplacement);\n    }\n  }\n\n  return html;\n}\n\nexport function unescape(html: string) {\n  // explicitly match decimal, hex, and named HTML entities\n  return html.replace(other.unescapeTest, (_, n) => {\n    n = n.toLowerCase();\n    if (n === 'colon') return ':';\n    if (n.charAt(0) === '#') {\n      return n.charAt(1) === 'x'\n        ? String.fromCharCode(parseInt(n.substring(2), 16))\n        : String.fromCharCode(+n.substring(1));\n    }\n    return '';\n  });\n}\n\nexport function cleanUrl(href: string) {\n  try {\n    href = encodeURI(href).replace(other.percentDecode, '%');\n  } catch {\n    return null;\n  }\n  return href;\n}\n\nexport function splitCells(tableRow: string, count?: number) {\n  // ensure that every cell-delimiting pipe has a space\n  // before it to distinguish it from an escaped pipe\n  const row = tableRow.replace(other.findPipe, (match, offset, str) => {\n      let escaped = false;\n      let curr = offset;\n      while (--curr >= 0 && str[curr] === '\\\\') escaped = !escaped;\n      if (escaped) {\n        // odd number of slashes means | is escaped\n        // so we leave it alone\n        return '|';\n      } else {\n        // add space before unescaped |\n        return ' |';\n      }\n    }),\n    cells = row.split(other.splitPipe);\n  let i = 0;\n\n  // First/last cell in a row cannot be empty if it has no leading/trailing pipe\n  if (!cells[0].trim()) {\n    cells.shift();\n  }\n  if (cells.length > 0 && !cells.at(-1)?.trim()) {\n    cells.pop();\n  }\n\n  if (count) {\n    if (cells.length > count) {\n      cells.splice(count);\n    } else {\n      while (cells.length < count) cells.push('');\n    }\n  }\n\n  for (; i < cells.length; i++) {\n    // leading or trailing whitespace is ignored per the gfm spec\n    cells[i] = cells[i].trim().replace(other.slashPipe, '|');\n  }\n  return cells;\n}\n\n/**\n * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n * /c*$/ is vulnerable to REDOS.\n *\n * @param str\n * @param c\n * @param invert Remove suffix of non-c chars instead. Default falsey.\n */\nexport function rtrim(str: string, c: string, invert?: boolean) {\n  const l = str.length;\n  if (l === 0) {\n    return '';\n  }\n\n  // Length of suffix matching the invert condition.\n  let suffLen = 0;\n\n  // Step left until we fail to match the invert condition.\n  while (suffLen < l) {\n    const currChar = str.charAt(l - suffLen - 1);\n    if (currChar === c && !invert) {\n      suffLen++;\n    } else if (currChar !== c && invert) {\n      suffLen++;\n    } else {\n      break;\n    }\n  }\n\n  return str.slice(0, l - suffLen);\n}\n\nexport function findClosingBracket(str: string, b: string) {\n  if (str.indexOf(b[1]) === -1) {\n    return -1;\n  }\n\n  let level = 0;\n  for (let i = 0; i < str.length; i++) {\n    if (str[i] === '\\\\') {\n      i++;\n    } else if (str[i] === b[0]) {\n      level++;\n    } else if (str[i] === b[1]) {\n      level--;\n      if (level < 0) {\n        return i;\n      }\n    }\n  }\n  if (level > 0) {\n    return -2;\n  }\n\n  return -1;\n}\n", "import { _defaults } from './defaults.ts';\nimport {\n  rtrim,\n  splitCells,\n  findClosingBracket,\n} from './helpers.ts';\nimport type { Rules } from './rules.ts';\nimport type { _Lexer } from './Lexer.ts';\nimport type { Links, Tokens, Token } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\nfunction outputLink(cap: string[], link: Pick<Tokens.Link, 'href' | 'title'>, raw: string, lexer: _Lexer, rules: Rules): Tokens.Link | Tokens.Image {\n  const href = link.href;\n  const title = link.title || null;\n  const text = cap[1].replace(rules.other.outputLinkReplace, '$1');\n\n  lexer.state.inLink = true;\n  const token: Tokens.Link | Tokens.Image = {\n    type: cap[0].charAt(0) === '!' ? 'image' : 'link',\n    raw,\n    href,\n    title,\n    text,\n    tokens: lexer.inlineTokens(text),\n  };\n  lexer.state.inLink = false;\n  return token;\n}\n\nfunction indentCodeCompensation(raw: string, text: string, rules: Rules) {\n  const matchIndentToCode = raw.match(rules.other.indentCodeCompensation);\n\n  if (matchIndentToCode === null) {\n    return text;\n  }\n\n  const indentToCode = matchIndentToCode[1];\n\n  return text\n    .split('\\n')\n    .map(node => {\n      const matchIndentInNode = node.match(rules.other.beginningSpace);\n      if (matchIndentInNode === null) {\n        return node;\n      }\n\n      const [indentInNode] = matchIndentInNode;\n\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n\n      return node;\n    })\n    .join('\\n');\n}\n\n/**\n * Tokenizer\n */\nexport class _Tokenizer {\n  options: MarkedOptions;\n  rules!: Rules; // set by the lexer\n  lexer!: _Lexer; // set by the lexer\n\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  space(src: string): Tokens.Space | undefined {\n    const cap = this.rules.block.newline.exec(src);\n    if (cap && cap[0].length > 0) {\n      return {\n        type: 'space',\n        raw: cap[0],\n      };\n    }\n  }\n\n  code(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.code.exec(src);\n    if (cap) {\n      const text = cap[0].replace(this.rules.other.codeRemoveIndent, '');\n      return {\n        type: 'code',\n        raw: cap[0],\n        codeBlockStyle: 'indented',\n        text: !this.options.pedantic\n          ? rtrim(text, '\\n')\n          : text,\n      };\n    }\n  }\n\n  fences(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.fences.exec(src);\n    if (cap) {\n      const raw = cap[0];\n      const text = indentCodeCompensation(raw, cap[3] || '', this.rules);\n\n      return {\n        type: 'code',\n        raw,\n        lang: cap[2] ? cap[2].trim().replace(this.rules.inline.anyPunctuation, '$1') : cap[2],\n        text,\n      };\n    }\n  }\n\n  heading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.heading.exec(src);\n    if (cap) {\n      let text = cap[2].trim();\n\n      // remove trailing #s\n      if (this.rules.other.endingHash.test(text)) {\n        const trimmed = rtrim(text, '#');\n        if (this.options.pedantic) {\n          text = trimmed.trim();\n        } else if (!trimmed || this.rules.other.endingSpaceChar.test(trimmed)) {\n          // CommonMark requires space before trailing #s\n          text = trimmed.trim();\n        }\n      }\n\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[1].length,\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  hr(src: string): Tokens.Hr | undefined {\n    const cap = this.rules.block.hr.exec(src);\n    if (cap) {\n      return {\n        type: 'hr',\n        raw: rtrim(cap[0], '\\n'),\n      };\n    }\n  }\n\n  blockquote(src: string): Tokens.Blockquote | undefined {\n    const cap = this.rules.block.blockquote.exec(src);\n    if (cap) {\n      let lines = rtrim(cap[0], '\\n').split('\\n');\n      let raw = '';\n      let text = '';\n      const tokens: Token[] = [];\n\n      while (lines.length > 0) {\n        let inBlockquote = false;\n        const currentLines = [];\n\n        let i;\n        for (i = 0; i < lines.length; i++) {\n          // get lines up to a continuation\n          if (this.rules.other.blockquoteStart.test(lines[i])) {\n            currentLines.push(lines[i]);\n            inBlockquote = true;\n          } else if (!inBlockquote) {\n            currentLines.push(lines[i]);\n          } else {\n            break;\n          }\n        }\n        lines = lines.slice(i);\n\n        const currentRaw = currentLines.join('\\n');\n        const currentText = currentRaw\n          // precede setext continuation with 4 spaces so it isn't a setext\n          .replace(this.rules.other.blockquoteSetextReplace, '\\n    $1')\n          .replace(this.rules.other.blockquoteSetextReplace2, '');\n        raw = raw ? `${raw}\\n${currentRaw}` : currentRaw;\n        text = text ? `${text}\\n${currentText}` : currentText;\n\n        // parse blockquote lines as top level tokens\n        // merge paragraphs if this is a continuation\n        const top = this.lexer.state.top;\n        this.lexer.state.top = true;\n        this.lexer.blockTokens(currentText, tokens, true);\n        this.lexer.state.top = top;\n\n        // if there is no continuation then we are done\n        if (lines.length === 0) {\n          break;\n        }\n\n        const lastToken = tokens.at(-1);\n\n        if (lastToken?.type === 'code') {\n          // blockquote continuation cannot be preceded by a code block\n          break;\n        } else if (lastToken?.type === 'blockquote') {\n          // include continuation in nested blockquote\n          const oldToken = lastToken as Tokens.Blockquote;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.blockquote(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - oldToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.text.length) + newToken.text;\n          break;\n        } else if (lastToken?.type === 'list') {\n          // include continuation in nested list\n          const oldToken = lastToken as Tokens.List;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.list(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - lastToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.raw.length) + newToken.raw;\n          lines = newText.substring(tokens.at(-1)!.raw.length).split('\\n');\n          continue;\n        }\n      }\n\n      return {\n        type: 'blockquote',\n        raw,\n        tokens,\n        text,\n      };\n    }\n  }\n\n  list(src: string): Tokens.List | undefined {\n    let cap = this.rules.block.list.exec(src);\n    if (cap) {\n      let bull = cap[1].trim();\n      const isordered = bull.length > 1;\n\n      const list: Tokens.List = {\n        type: 'list',\n        raw: '',\n        ordered: isordered,\n        start: isordered ? +bull.slice(0, -1) : '',\n        loose: false,\n        items: [],\n      };\n\n      bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n\n      if (this.options.pedantic) {\n        bull = isordered ? bull : '[*+-]';\n      }\n\n      // Get next list item\n      const itemRegex = this.rules.other.listItemRegex(bull);\n      let endsWithBlankLine = false;\n      // Check if current bullet point can start a new List Item\n      while (src) {\n        let endEarly = false;\n        let raw = '';\n        let itemContents = '';\n        if (!(cap = itemRegex.exec(src))) {\n          break;\n        }\n\n        if (this.rules.block.hr.test(src)) { // End list if bullet was actually HR (possibly move into itemRegex?)\n          break;\n        }\n\n        raw = cap[0];\n        src = src.substring(raw.length);\n\n        let line = cap[2].split('\\n', 1)[0].replace(this.rules.other.listReplaceTabs, (t: string) => ' '.repeat(3 * t.length));\n        let nextLine = src.split('\\n', 1)[0];\n        let blankLine = !line.trim();\n\n        let indent = 0;\n        if (this.options.pedantic) {\n          indent = 2;\n          itemContents = line.trimStart();\n        } else if (blankLine) {\n          indent = cap[1].length + 1;\n        } else {\n          indent = cap[2].search(this.rules.other.nonSpaceChar); // Find first non-space char\n          indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent\n          itemContents = line.slice(indent);\n          indent += cap[1].length;\n        }\n\n        if (blankLine && this.rules.other.blankLine.test(nextLine)) { // Items begin with at most one blank line\n          raw += nextLine + '\\n';\n          src = src.substring(nextLine.length + 1);\n          endEarly = true;\n        }\n\n        if (!endEarly) {\n          const nextBulletRegex = this.rules.other.nextBulletRegex(indent);\n          const hrRegex = this.rules.other.hrRegex(indent);\n          const fencesBeginRegex = this.rules.other.fencesBeginRegex(indent);\n          const headingBeginRegex = this.rules.other.headingBeginRegex(indent);\n          const htmlBeginRegex = this.rules.other.htmlBeginRegex(indent);\n\n          // Check if following lines should be included in List Item\n          while (src) {\n            const rawLine = src.split('\\n', 1)[0];\n            let nextLineWithoutTabs;\n            nextLine = rawLine;\n\n            // Re-align to follow commonmark nesting rules\n            if (this.options.pedantic) {\n              nextLine = nextLine.replace(this.rules.other.listReplaceNesting, '  ');\n              nextLineWithoutTabs = nextLine;\n            } else {\n              nextLineWithoutTabs = nextLine.replace(this.rules.other.tabCharGlobal, '    ');\n            }\n\n            // End list item if found code fences\n            if (fencesBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new heading\n            if (headingBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of html block\n            if (htmlBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new bullet\n            if (nextBulletRegex.test(nextLine)) {\n              break;\n            }\n\n            // Horizontal rule found\n            if (hrRegex.test(nextLine)) {\n              break;\n            }\n\n            if (nextLineWithoutTabs.search(this.rules.other.nonSpaceChar) >= indent || !nextLine.trim()) { // Dedent if possible\n              itemContents += '\\n' + nextLineWithoutTabs.slice(indent);\n            } else {\n              // not enough indentation\n              if (blankLine) {\n                break;\n              }\n\n              // paragraph continuation unless last line was a different block level element\n              if (line.replace(this.rules.other.tabCharGlobal, '    ').search(this.rules.other.nonSpaceChar) >= 4) { // indented code block\n                break;\n              }\n              if (fencesBeginRegex.test(line)) {\n                break;\n              }\n              if (headingBeginRegex.test(line)) {\n                break;\n              }\n              if (hrRegex.test(line)) {\n                break;\n              }\n\n              itemContents += '\\n' + nextLine;\n            }\n\n            if (!blankLine && !nextLine.trim()) { // Check if current line is blank\n              blankLine = true;\n            }\n\n            raw += rawLine + '\\n';\n            src = src.substring(rawLine.length + 1);\n            line = nextLineWithoutTabs.slice(indent);\n          }\n        }\n\n        if (!list.loose) {\n          // If the previous item ended with a blank line, the list is loose\n          if (endsWithBlankLine) {\n            list.loose = true;\n          } else if (this.rules.other.doubleBlankLine.test(raw)) {\n            endsWithBlankLine = true;\n          }\n        }\n\n        let istask: RegExpExecArray | null = null;\n        let ischecked: boolean | undefined;\n        // Check for task list items\n        if (this.options.gfm) {\n          istask = this.rules.other.listIsTask.exec(itemContents);\n          if (istask) {\n            ischecked = istask[0] !== '[ ] ';\n            itemContents = itemContents.replace(this.rules.other.listReplaceTask, '');\n          }\n        }\n\n        list.items.push({\n          type: 'list_item',\n          raw,\n          task: !!istask,\n          checked: ischecked,\n          loose: false,\n          text: itemContents,\n          tokens: [],\n        });\n\n        list.raw += raw;\n      }\n\n      // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic\n      const lastItem = list.items.at(-1);\n      if (lastItem) {\n        lastItem.raw = lastItem.raw.trimEnd();\n        lastItem.text = lastItem.text.trimEnd();\n      } else {\n        // not a list since there were no items\n        return;\n      }\n      list.raw = list.raw.trimEnd();\n\n      // Item child tokens handled here at end because we needed to have the final item to trim it first\n      for (let i = 0; i < list.items.length; i++) {\n        this.lexer.state.top = false;\n        list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);\n\n        if (!list.loose) {\n          // Check if list should be loose\n          const spacers = list.items[i].tokens.filter(t => t.type === 'space');\n          const hasMultipleLineBreaks = spacers.length > 0 && spacers.some(t => this.rules.other.anyLine.test(t.raw));\n\n          list.loose = hasMultipleLineBreaks;\n        }\n      }\n\n      // Set all items to loose if list is loose\n      if (list.loose) {\n        for (let i = 0; i < list.items.length; i++) {\n          list.items[i].loose = true;\n        }\n      }\n\n      return list;\n    }\n  }\n\n  html(src: string): Tokens.HTML | undefined {\n    const cap = this.rules.block.html.exec(src);\n    if (cap) {\n      const token: Tokens.HTML = {\n        type: 'html',\n        block: true,\n        raw: cap[0],\n        pre: cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style',\n        text: cap[0],\n      };\n      return token;\n    }\n  }\n\n  def(src: string): Tokens.Def | undefined {\n    const cap = this.rules.block.def.exec(src);\n    if (cap) {\n      const tag = cap[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const href = cap[2] ? cap[2].replace(this.rules.other.hrefBrackets, '$1').replace(this.rules.inline.anyPunctuation, '$1') : '';\n      const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline.anyPunctuation, '$1') : cap[3];\n      return {\n        type: 'def',\n        tag,\n        raw: cap[0],\n        href,\n        title,\n      };\n    }\n  }\n\n  table(src: string): Tokens.Table | undefined {\n    const cap = this.rules.block.table.exec(src);\n    if (!cap) {\n      return;\n    }\n\n    if (!this.rules.other.tableDelimiter.test(cap[2])) {\n      // delimiter row must have a pipe (|) or colon (:) otherwise it is a setext heading\n      return;\n    }\n\n    const headers = splitCells(cap[1]);\n    const aligns = cap[2].replace(this.rules.other.tableAlignChars, '').split('|');\n    const rows = cap[3]?.trim() ? cap[3].replace(this.rules.other.tableRowBlankLine, '').split('\\n') : [];\n\n    const item: Tokens.Table = {\n      type: 'table',\n      raw: cap[0],\n      header: [],\n      align: [],\n      rows: [],\n    };\n\n    if (headers.length !== aligns.length) {\n      // header and align columns must be equal, rows can be different.\n      return;\n    }\n\n    for (const align of aligns) {\n      if (this.rules.other.tableAlignRight.test(align)) {\n        item.align.push('right');\n      } else if (this.rules.other.tableAlignCenter.test(align)) {\n        item.align.push('center');\n      } else if (this.rules.other.tableAlignLeft.test(align)) {\n        item.align.push('left');\n      } else {\n        item.align.push(null);\n      }\n    }\n\n    for (let i = 0; i < headers.length; i++) {\n      item.header.push({\n        text: headers[i],\n        tokens: this.lexer.inline(headers[i]),\n        header: true,\n        align: item.align[i],\n      });\n    }\n\n    for (const row of rows) {\n      item.rows.push(splitCells(row, item.header.length).map((cell, i) => {\n        return {\n          text: cell,\n          tokens: this.lexer.inline(cell),\n          header: false,\n          align: item.align[i],\n        };\n      }));\n    }\n\n    return item;\n  }\n\n  lheading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.lheading.exec(src);\n    if (cap) {\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[2].charAt(0) === '=' ? 1 : 2,\n        text: cap[1],\n        tokens: this.lexer.inline(cap[1]),\n      };\n    }\n  }\n\n  paragraph(src: string): Tokens.Paragraph | undefined {\n    const cap = this.rules.block.paragraph.exec(src);\n    if (cap) {\n      const text = cap[1].charAt(cap[1].length - 1) === '\\n'\n        ? cap[1].slice(0, -1)\n        : cap[1];\n      return {\n        type: 'paragraph',\n        raw: cap[0],\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  text(src: string): Tokens.Text | undefined {\n    const cap = this.rules.block.text.exec(src);\n    if (cap) {\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        tokens: this.lexer.inline(cap[0]),\n      };\n    }\n  }\n\n  escape(src: string): Tokens.Escape | undefined {\n    const cap = this.rules.inline.escape.exec(src);\n    if (cap) {\n      return {\n        type: 'escape',\n        raw: cap[0],\n        text: cap[1],\n      };\n    }\n  }\n\n  tag(src: string): Tokens.Tag | undefined {\n    const cap = this.rules.inline.tag.exec(src);\n    if (cap) {\n      if (!this.lexer.state.inLink && this.rules.other.startATag.test(cap[0])) {\n        this.lexer.state.inLink = true;\n      } else if (this.lexer.state.inLink && this.rules.other.endATag.test(cap[0])) {\n        this.lexer.state.inLink = false;\n      }\n      if (!this.lexer.state.inRawBlock && this.rules.other.startPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = true;\n      } else if (this.lexer.state.inRawBlock && this.rules.other.endPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = false;\n      }\n\n      return {\n        type: 'html',\n        raw: cap[0],\n        inLink: this.lexer.state.inLink,\n        inRawBlock: this.lexer.state.inRawBlock,\n        block: false,\n        text: cap[0],\n      };\n    }\n  }\n\n  link(src: string): Tokens.Link | Tokens.Image | undefined {\n    const cap = this.rules.inline.link.exec(src);\n    if (cap) {\n      const trimmedUrl = cap[2].trim();\n      if (!this.options.pedantic && this.rules.other.startAngleBracket.test(trimmedUrl)) {\n        // commonmark requires matching angle brackets\n        if (!(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          return;\n        }\n\n        // ending angle bracket cannot be escaped\n        const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\\\');\n        if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n          return;\n        }\n      } else {\n        // find closing parenthesis\n        const lastParenIndex = findClosingBracket(cap[2], '()');\n        if (lastParenIndex === -2) {\n          // more open parens than closed\n          return;\n        }\n\n        if (lastParenIndex > -1) {\n          const start = cap[0].indexOf('!') === 0 ? 5 : 4;\n          const linkLen = start + cap[1].length + lastParenIndex;\n          cap[2] = cap[2].substring(0, lastParenIndex);\n          cap[0] = cap[0].substring(0, linkLen).trim();\n          cap[3] = '';\n        }\n      }\n      let href = cap[2];\n      let title = '';\n      if (this.options.pedantic) {\n        // split pedantic href and title\n        const link = this.rules.other.pedanticHrefTitle.exec(href);\n\n        if (link) {\n          href = link[1];\n          title = link[3];\n        }\n      } else {\n        title = cap[3] ? cap[3].slice(1, -1) : '';\n      }\n\n      href = href.trim();\n      if (this.rules.other.startAngleBracket.test(href)) {\n        if (this.options.pedantic && !(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          // pedantic allows starting angle bracket without ending angle bracket\n          href = href.slice(1);\n        } else {\n          href = href.slice(1, -1);\n        }\n      }\n      return outputLink(cap, {\n        href: href ? href.replace(this.rules.inline.anyPunctuation, '$1') : href,\n        title: title ? title.replace(this.rules.inline.anyPunctuation, '$1') : title,\n      }, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  reflink(src: string, links: Links): Tokens.Link | Tokens.Image | Tokens.Text | undefined {\n    let cap;\n    if ((cap = this.rules.inline.reflink.exec(src))\n      || (cap = this.rules.inline.nolink.exec(src))) {\n      const linkString = (cap[2] || cap[1]).replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const link = links[linkString.toLowerCase()];\n      if (!link) {\n        const text = cap[0].charAt(0);\n        return {\n          type: 'text',\n          raw: text,\n          text,\n        };\n      }\n      return outputLink(cap, link, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  emStrong(src: string, maskedSrc: string, prevChar = ''): Tokens.Em | Tokens.Strong | undefined {\n    let match = this.rules.inline.emStrongLDelim.exec(src);\n    if (!match) return;\n\n    // _ can't be between two alphanumerics. \\p{L}\\p{N} includes non-english alphabet/numbers as well\n    if (match[3] && prevChar.match(this.rules.other.unicodeAlphaNumeric)) return;\n\n    const nextChar = match[1] || match[2] || '';\n\n    if (!nextChar || !prevChar || this.rules.inline.punctuation.exec(prevChar)) {\n      // unicode Regex counts emoji as 1 char; spread into array for proper count (used multiple times below)\n      const lLength = [...match[0]].length - 1;\n      let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n\n      const endReg = match[0][0] === '*' ? this.rules.inline.emStrongRDelimAst : this.rules.inline.emStrongRDelimUnd;\n      endReg.lastIndex = 0;\n\n      // Clip maskedSrc to same section of string as src (move to lexer?)\n      maskedSrc = maskedSrc.slice(-1 * src.length + lLength);\n\n      while ((match = endReg.exec(maskedSrc)) != null) {\n        rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n\n        if (!rDelim) continue; // skip single * in __abc*abc__\n\n        rLength = [...rDelim].length;\n\n        if (match[3] || match[4]) { // found another Left Delim\n          delimTotal += rLength;\n          continue;\n        } else if (match[5] || match[6]) { // either Left or Right Delim\n          if (lLength % 3 && !((lLength + rLength) % 3)) {\n            midDelimTotal += rLength;\n            continue; // CommonMark Emphasis Rules 9-10\n          }\n        }\n\n        delimTotal -= rLength;\n\n        if (delimTotal > 0) continue; // Haven't found enough closing delimiters\n\n        // Remove extra characters. *a*** -> *a*\n        rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n        // char length can be >1 for unicode characters;\n        const lastCharLength = [...match[0]][0].length;\n        const raw = src.slice(0, lLength + match.index + lastCharLength + rLength);\n\n        // Create `em` if smallest delimiter has odd char count. *a***\n        if (Math.min(lLength, rLength) % 2) {\n          const text = raw.slice(1, -1);\n          return {\n            type: 'em',\n            raw,\n            text,\n            tokens: this.lexer.inlineTokens(text),\n          };\n        }\n\n        // Create 'strong' if smallest delimiter has even char count. **a***\n        const text = raw.slice(2, -2);\n        return {\n          type: 'strong',\n          raw,\n          text,\n          tokens: this.lexer.inlineTokens(text),\n        };\n      }\n    }\n  }\n\n  codespan(src: string): Tokens.Codespan | undefined {\n    const cap = this.rules.inline.code.exec(src);\n    if (cap) {\n      let text = cap[2].replace(this.rules.other.newLineCharGlobal, ' ');\n      const hasNonSpaceChars = this.rules.other.nonSpaceChar.test(text);\n      const hasSpaceCharsOnBothEnds = this.rules.other.startingSpaceChar.test(text) && this.rules.other.endingSpaceChar.test(text);\n      if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n        text = text.substring(1, text.length - 1);\n      }\n      return {\n        type: 'codespan',\n        raw: cap[0],\n        text,\n      };\n    }\n  }\n\n  br(src: string): Tokens.Br | undefined {\n    const cap = this.rules.inline.br.exec(src);\n    if (cap) {\n      return {\n        type: 'br',\n        raw: cap[0],\n      };\n    }\n  }\n\n  del(src: string): Tokens.Del | undefined {\n    const cap = this.rules.inline.del.exec(src);\n    if (cap) {\n      return {\n        type: 'del',\n        raw: cap[0],\n        text: cap[2],\n        tokens: this.lexer.inlineTokens(cap[2]),\n      };\n    }\n  }\n\n  autolink(src: string): Tokens.Link | undefined {\n    const cap = this.rules.inline.autolink.exec(src);\n    if (cap) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[1];\n        href = 'mailto:' + text;\n      } else {\n        text = cap[1];\n        href = text;\n      }\n\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  url(src: string): Tokens.Link | undefined {\n    let cap;\n    if (cap = this.rules.inline.url.exec(src)) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[0];\n        href = 'mailto:' + text;\n      } else {\n        // do extended autolink path validation\n        let prevCapZero;\n        do {\n          prevCapZero = cap[0];\n          cap[0] = this.rules.inline._backpedal.exec(cap[0])?.[0] ?? '';\n        } while (prevCapZero !== cap[0]);\n        text = cap[0];\n        if (cap[1] === 'www.') {\n          href = 'http://' + cap[0];\n        } else {\n          href = cap[0];\n        }\n      }\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  inlineText(src: string): Tokens.Text | undefined {\n    const cap = this.rules.inline.text.exec(src);\n    if (cap) {\n      const escaped = this.lexer.state.inRawBlock;\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        escaped,\n      };\n    }\n  }\n}\n", "import { _Tokenizer } from './Tokenizer.ts';\nimport { _defaults } from './defaults.ts';\nimport { other, block, inline } from './rules.ts';\nimport type { Token, TokensList, Tokens } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Block Lexer\n */\nexport class _Lexer {\n  tokens: TokensList;\n  options: MarkedOptions;\n  state: {\n    inLink: boolean;\n    inRawBlock: boolean;\n    top: boolean;\n  };\n\n  private tokenizer: _Tokenizer;\n  private inlineQueue: { src: string, tokens: Token[] }[];\n\n  constructor(options?: MarkedOptions) {\n    // TokenList cannot be created in one go\n    this.tokens = [] as unknown as TokensList;\n    this.tokens.links = Object.create(null);\n    this.options = options || _defaults;\n    this.options.tokenizer = this.options.tokenizer || new _Tokenizer();\n    this.tokenizer = this.options.tokenizer;\n    this.tokenizer.options = this.options;\n    this.tokenizer.lexer = this;\n    this.inlineQueue = [];\n    this.state = {\n      inLink: false,\n      inRawBlock: false,\n      top: true,\n    };\n\n    const rules = {\n      other,\n      block: block.normal,\n      inline: inline.normal,\n    };\n\n    if (this.options.pedantic) {\n      rules.block = block.pedantic;\n      rules.inline = inline.pedantic;\n    } else if (this.options.gfm) {\n      rules.block = block.gfm;\n      if (this.options.breaks) {\n        rules.inline = inline.breaks;\n      } else {\n        rules.inline = inline.gfm;\n      }\n    }\n    this.tokenizer.rules = rules;\n  }\n\n  /**\n   * Expose Rules\n   */\n  static get rules() {\n    return {\n      block,\n      inline,\n    };\n  }\n\n  /**\n   * Static Lex Method\n   */\n  static lex(src: string, options?: MarkedOptions) {\n    const lexer = new _Lexer(options);\n    return lexer.lex(src);\n  }\n\n  /**\n   * Static Lex Inline Method\n   */\n  static lexInline(src: string, options?: MarkedOptions) {\n    const lexer = new _Lexer(options);\n    return lexer.inlineTokens(src);\n  }\n\n  /**\n   * Preprocessing\n   */\n  lex(src: string) {\n    src = src.replace(other.carriageReturn, '\\n');\n\n    this.blockTokens(src, this.tokens);\n\n    for (let i = 0; i < this.inlineQueue.length; i++) {\n      const next = this.inlineQueue[i];\n      this.inlineTokens(next.src, next.tokens);\n    }\n    this.inlineQueue = [];\n\n    return this.tokens;\n  }\n\n  /**\n   * Lexing\n   */\n  blockTokens(src: string, tokens?: Token[], lastParagraphClipped?: boolean): Token[];\n  blockTokens(src: string, tokens?: TokensList, lastParagraphClipped?: boolean): TokensList;\n  blockTokens(src: string, tokens: Token[] = [], lastParagraphClipped = false) {\n    if (this.options.pedantic) {\n      src = src.replace(other.tabCharGlobal, '    ').replace(other.spaceLine, '');\n    }\n\n    while (src) {\n      let token: Tokens.Generic | undefined;\n\n      if (this.options.extensions?.block?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // newline\n      if (token = this.tokenizer.space(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.raw.length === 1 && lastToken !== undefined) {\n          // if there's a single \\n as a spacer, it's terminating the last line,\n          // so move it there so that we don't get unnecessary paragraph tags\n          lastToken.raw += '\\n';\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.code(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        // An indented code block cannot interrupt a paragraph.\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // fences\n      if (token = this.tokenizer.fences(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // heading\n      if (token = this.tokenizer.heading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // hr\n      if (token = this.tokenizer.hr(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // blockquote\n      if (token = this.tokenizer.blockquote(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // list\n      if (token = this.tokenizer.list(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // html\n      if (token = this.tokenizer.html(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // def\n      if (token = this.tokenizer.def(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.raw;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else if (!this.tokens.links[token.tag]) {\n          this.tokens.links[token.tag] = {\n            href: token.href,\n            title: token.title,\n          };\n        }\n        continue;\n      }\n\n      // table (gfm)\n      if (token = this.tokenizer.table(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // lheading\n      if (token = this.tokenizer.lheading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // top-level paragraph\n      // prevent paragraph consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startBlock) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startBlock.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n        const lastToken = tokens.at(-1);\n        if (lastParagraphClipped && lastToken?.type === 'paragraph') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        lastParagraphClipped = cutSrc.length !== src.length;\n        src = src.substring(token.raw.length);\n        continue;\n      }\n\n      // text\n      if (token = this.tokenizer.text(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    this.state.top = true;\n    return tokens;\n  }\n\n  inline(src: string, tokens: Token[] = []) {\n    this.inlineQueue.push({ src, tokens });\n    return tokens;\n  }\n\n  /**\n   * Lexing/Compiling\n   */\n  inlineTokens(src: string, tokens: Token[] = []): Token[] {\n    // String with links masked to avoid interference with em and strong\n    let maskedSrc = src;\n    let match: RegExpExecArray | null = null;\n\n    // Mask out reflinks\n    if (this.tokens.links) {\n      const links = Object.keys(this.tokens.links);\n      if (links.length > 0) {\n        while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n          if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n            maskedSrc = maskedSrc.slice(0, match.index)\n              + '[' + 'a'.repeat(match[0].length - 2) + ']'\n              + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n          }\n        }\n      }\n    }\n\n    // Mask out escaped characters\n    while ((match = this.tokenizer.rules.inline.anyPunctuation.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);\n    }\n\n    // Mask out other blocks\n    while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '[' + 'a'.repeat(match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n    }\n\n    let keepPrevChar = false;\n    let prevChar = '';\n    while (src) {\n      if (!keepPrevChar) {\n        prevChar = '';\n      }\n      keepPrevChar = false;\n\n      let token: Tokens.Generic | undefined;\n\n      // extensions\n      if (this.options.extensions?.inline?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // escape\n      if (token = this.tokenizer.escape(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // tag\n      if (token = this.tokenizer.tag(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // link\n      if (token = this.tokenizer.link(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // reflink, nolink\n      if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.type === 'text' && lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // em & strong\n      if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.codespan(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // br\n      if (token = this.tokenizer.br(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // del (gfm)\n      if (token = this.tokenizer.del(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // autolink\n      if (token = this.tokenizer.autolink(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // url (gfm)\n      if (!this.state.inLink && (token = this.tokenizer.url(src))) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // text\n      // prevent inlineText consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startInline) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startInline.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (token = this.tokenizer.inlineText(cutSrc)) {\n        src = src.substring(token.raw.length);\n        if (token.raw.slice(-1) !== '_') { // Track prevChar before string of ____ started\n          prevChar = token.raw.slice(-1);\n        }\n        keepPrevChar = true;\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    return tokens;\n  }\n}\n", "import { _defaults } from './defaults.ts';\nimport {\n  cleanUrl,\n  escape,\n} from './helpers.ts';\nimport { other } from './rules.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\nimport type { Tokens } from './Tokens.ts';\nimport type { _Parser } from './Parser.ts';\n\n/**\n * Renderer\n */\nexport class _Renderer {\n  options: MarkedOptions;\n  parser!: _Parser; // set by the parser\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  space(token: Tokens.Space): string {\n    return '';\n  }\n\n  code({ text, lang, escaped }: Tokens.Code): string {\n    const langString = (lang || '').match(other.notSpaceStart)?.[0];\n\n    const code = text.replace(other.endingNewline, '') + '\\n';\n\n    if (!langString) {\n      return '<pre><code>'\n        + (escaped ? code : escape(code, true))\n        + '</code></pre>\\n';\n    }\n\n    return '<pre><code class=\"language-'\n      + escape(langString)\n      + '\">'\n      + (escaped ? code : escape(code, true))\n      + '</code></pre>\\n';\n  }\n\n  blockquote({ tokens }: Tokens.Blockquote): string {\n    const body = this.parser.parse(tokens);\n    return `<blockquote>\\n${body}</blockquote>\\n`;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag) : string {\n    return text;\n  }\n\n  heading({ tokens, depth }: Tokens.Heading): string {\n    return `<h${depth}>${this.parser.parseInline(tokens)}</h${depth}>\\n`;\n  }\n\n  hr(token: Tokens.Hr): string {\n    return '<hr>\\n';\n  }\n\n  list(token: Tokens.List): string {\n    const ordered = token.ordered;\n    const start = token.start;\n\n    let body = '';\n    for (let j = 0; j < token.items.length; j++) {\n      const item = token.items[j];\n      body += this.listitem(item);\n    }\n\n    const type = ordered ? 'ol' : 'ul';\n    const startAttr = (ordered && start !== 1) ? (' start=\"' + start + '\"') : '';\n    return '<' + type + startAttr + '>\\n' + body + '</' + type + '>\\n';\n  }\n\n  listitem(item: Tokens.ListItem): string {\n    let itemBody = '';\n    if (item.task) {\n      const checkbox = this.checkbox({ checked: !!item.checked });\n      if (item.loose) {\n        if (item.tokens[0]?.type === 'paragraph') {\n          item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;\n          if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {\n            item.tokens[0].tokens[0].text = checkbox + ' ' + escape(item.tokens[0].tokens[0].text);\n            item.tokens[0].tokens[0].escaped = true;\n          }\n        } else {\n          item.tokens.unshift({\n            type: 'text',\n            raw: checkbox + ' ',\n            text: checkbox + ' ',\n            escaped: true,\n          });\n        }\n      } else {\n        itemBody += checkbox + ' ';\n      }\n    }\n\n    itemBody += this.parser.parse(item.tokens, !!item.loose);\n\n    return `<li>${itemBody}</li>\\n`;\n  }\n\n  checkbox({ checked }: Tokens.Checkbox): string {\n    return '<input '\n      + (checked ? 'checked=\"\" ' : '')\n      + 'disabled=\"\" type=\"checkbox\">';\n  }\n\n  paragraph({ tokens }: Tokens.Paragraph): string {\n    return `<p>${this.parser.parseInline(tokens)}</p>\\n`;\n  }\n\n  table(token: Tokens.Table): string {\n    let header = '';\n\n    // header\n    let cell = '';\n    for (let j = 0; j < token.header.length; j++) {\n      cell += this.tablecell(token.header[j]);\n    }\n    header += this.tablerow({ text: cell });\n\n    let body = '';\n    for (let j = 0; j < token.rows.length; j++) {\n      const row = token.rows[j];\n\n      cell = '';\n      for (let k = 0; k < row.length; k++) {\n        cell += this.tablecell(row[k]);\n      }\n\n      body += this.tablerow({ text: cell });\n    }\n    if (body) body = `<tbody>${body}</tbody>`;\n\n    return '<table>\\n'\n      + '<thead>\\n'\n      + header\n      + '</thead>\\n'\n      + body\n      + '</table>\\n';\n  }\n\n  tablerow({ text }: Tokens.TableRow): string {\n    return `<tr>\\n${text}</tr>\\n`;\n  }\n\n  tablecell(token: Tokens.TableCell): string {\n    const content = this.parser.parseInline(token.tokens);\n    const type = token.header ? 'th' : 'td';\n    const tag = token.align\n      ? `<${type} align=\"${token.align}\">`\n      : `<${type}>`;\n    return tag + content + `</${type}>\\n`;\n  }\n\n  /**\n   * span level renderer\n   */\n  strong({ tokens }: Tokens.Strong): string {\n    return `<strong>${this.parser.parseInline(tokens)}</strong>`;\n  }\n\n  em({ tokens }: Tokens.Em): string {\n    return `<em>${this.parser.parseInline(tokens)}</em>`;\n  }\n\n  codespan({ text }: Tokens.Codespan): string {\n    return `<code>${escape(text, true)}</code>`;\n  }\n\n  br(token: Tokens.Br): string {\n    return '<br>';\n  }\n\n  del({ tokens }: Tokens.Del): string {\n    return `<del>${this.parser.parseInline(tokens)}</del>`;\n  }\n\n  link({ href, title, tokens }: Tokens.Link): string {\n    const text = this.parser.parseInline(tokens);\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return text;\n    }\n    href = cleanHref;\n    let out = '<a href=\"' + href + '\"';\n    if (title) {\n      out += ' title=\"' + (escape(title)) + '\"';\n    }\n    out += '>' + text + '</a>';\n    return out;\n  }\n\n  image({ href, title, text, tokens }: Tokens.Image): string {\n    if (tokens) {\n      text = this.parser.parseInline(tokens, this.parser.textRenderer);\n    }\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return escape(text);\n    }\n    href = cleanHref;\n\n    let out = `<img src=\"${href}\" alt=\"${text}\"`;\n    if (title) {\n      out += ` title=\"${escape(title)}\"`;\n    }\n    out += '>';\n    return out;\n  }\n\n  text(token: Tokens.Text | Tokens.Escape) : string {\n    return 'tokens' in token && token.tokens\n      ? this.parser.parseInline(token.tokens)\n      : ('escaped' in token && token.escaped ? token.text : escape(token.text));\n  }\n}\n", "import type { Tokens } from './Tokens.ts';\n\n/**\n * TextRenderer\n * returns only the textual part of the token\n */\nexport class _TextRenderer {\n  // no need for block level renderers\n  strong({ text }: Tokens.Strong) {\n    return text;\n  }\n\n  em({ text }: Tokens.Em) {\n    return text;\n  }\n\n  codespan({ text }: Tokens.Codespan) {\n    return text;\n  }\n\n  del({ text }: Tokens.Del) {\n    return text;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag) {\n    return text;\n  }\n\n  text({ text }: Tokens.Text | Tokens.Escape | Tokens.Tag) {\n    return text;\n  }\n\n  link({ text }: Tokens.Link) {\n    return '' + text;\n  }\n\n  image({ text }: Tokens.Image) {\n    return '' + text;\n  }\n\n  br() {\n    return '';\n  }\n}\n", "import { _Renderer } from './Renderer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { _defaults } from './defaults.ts';\nimport type { MarkedToken, Token, Tokens } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Parsing & Compiling\n */\nexport class _Parser {\n  options: MarkedOptions;\n  renderer: _Renderer;\n  textRenderer: _TextRenderer;\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n    this.options.renderer = this.options.renderer || new _Renderer();\n    this.renderer = this.options.renderer;\n    this.renderer.options = this.options;\n    this.renderer.parser = this;\n    this.textRenderer = new _TextRenderer();\n  }\n\n  /**\n   * Static Parse Method\n   */\n  static parse(tokens: Token[], options?: MarkedOptions) {\n    const parser = new _Parser(options);\n    return parser.parse(tokens);\n  }\n\n  /**\n   * Static Parse Inline Method\n   */\n  static parseInline(tokens: Token[], options?: MarkedOptions) {\n    const parser = new _Parser(options);\n    return parser.parseInline(tokens);\n  }\n\n  /**\n   * Parse Loop\n   */\n  parse(tokens: Token[], top = true): string {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const genericToken = anyToken as Tokens.Generic;\n        const ret = this.options.extensions.renderers[genericToken.type].call({ parser: this }, genericToken);\n        if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'paragraph', 'text'].includes(genericToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'space': {\n          out += this.renderer.space(token);\n          continue;\n        }\n        case 'hr': {\n          out += this.renderer.hr(token);\n          continue;\n        }\n        case 'heading': {\n          out += this.renderer.heading(token);\n          continue;\n        }\n        case 'code': {\n          out += this.renderer.code(token);\n          continue;\n        }\n        case 'table': {\n          out += this.renderer.table(token);\n          continue;\n        }\n        case 'blockquote': {\n          out += this.renderer.blockquote(token);\n          continue;\n        }\n        case 'list': {\n          out += this.renderer.list(token);\n          continue;\n        }\n        case 'html': {\n          out += this.renderer.html(token);\n          continue;\n        }\n        case 'paragraph': {\n          out += this.renderer.paragraph(token);\n          continue;\n        }\n        case 'text': {\n          let textToken = token;\n          let body = this.renderer.text(textToken);\n          while (i + 1 < tokens.length && tokens[i + 1].type === 'text') {\n            textToken = tokens[++i] as Tokens.Text;\n            body += '\\n' + this.renderer.text(textToken);\n          }\n          if (top) {\n            out += this.renderer.paragraph({\n              type: 'paragraph',\n              raw: body,\n              text: body,\n              tokens: [{ type: 'text', raw: body, text: body, escaped: true }],\n            });\n          } else {\n            out += body;\n          }\n          continue;\n        }\n\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '';\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n\n    return out;\n  }\n\n  /**\n   * Parse Inline Tokens\n   */\n  parseInline(tokens: Token[], renderer: _Renderer | _TextRenderer = this.renderer): string {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const ret = this.options.extensions.renderers[anyToken.type].call({ parser: this }, anyToken);\n        if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(anyToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'escape': {\n          out += renderer.text(token);\n          break;\n        }\n        case 'html': {\n          out += renderer.html(token);\n          break;\n        }\n        case 'link': {\n          out += renderer.link(token);\n          break;\n        }\n        case 'image': {\n          out += renderer.image(token);\n          break;\n        }\n        case 'strong': {\n          out += renderer.strong(token);\n          break;\n        }\n        case 'em': {\n          out += renderer.em(token);\n          break;\n        }\n        case 'codespan': {\n          out += renderer.codespan(token);\n          break;\n        }\n        case 'br': {\n          out += renderer.br(token);\n          break;\n        }\n        case 'del': {\n          out += renderer.del(token);\n          break;\n        }\n        case 'text': {\n          out += renderer.text(token);\n          break;\n        }\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '';\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n    return out;\n  }\n}\n", "import { _defaults } from './defaults.ts';\nimport { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, TokensList } from './Tokens.ts';\n\nexport class _Hooks {\n  options: MarkedOptions;\n  block?: boolean;\n\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  static passThroughHooks = new Set([\n    'preprocess',\n    'postprocess',\n    'processAllTokens',\n  ]);\n\n  /**\n   * Process markdown before marked\n   */\n  preprocess(markdown: string) {\n    return markdown;\n  }\n\n  /**\n   * Process HTML after marked is finished\n   */\n  postprocess(html: string) {\n    return html;\n  }\n\n  /**\n   * Process all tokens before walk tokens\n   */\n  processAllTokens(tokens: Token[] | TokensList) {\n    return tokens;\n  }\n\n  /**\n   * Provide function to tokenize markdown\n   */\n  provideLexer() {\n    return this.block ? _Lexer.lex : _Lexer.lexInline;\n  }\n\n  /**\n   * Provide function to parse tokens\n   */\n  provideParser() {\n    return this.block ? _Parser.parse : _Parser.parseInline;\n  }\n}\n", "import { _getDefaults } from './defaults.ts';\nimport { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport { _Hooks } from './Hooks.ts';\nimport { _Renderer } from './Renderer.ts';\nimport { _Tokenizer } from './Tokenizer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { escape } from './helpers.ts';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, Tokens, TokensList } from './Tokens.ts';\n\nexport type MaybePromise = void | Promise<void>;\n\ntype UnknownFunction = (...args: unknown[]) => unknown;\ntype GenericRendererFunction = (...args: unknown[]) => string | false;\n\nexport class Marked {\n  defaults = _getDefaults();\n  options = this.setOptions;\n\n  parse = this.parseMarkdown(true);\n  parseInline = this.parseMarkdown(false);\n\n  Parser = _Parser;\n  Renderer = _Renderer;\n  TextRenderer = _TextRenderer;\n  Lexer = _Lexer;\n  Tokenizer = _Tokenizer;\n  Hooks = _Hooks;\n\n  constructor(...args: MarkedExtension[]) {\n    this.use(...args);\n  }\n\n  /**\n   * Run callback for every token\n   */\n  walkTokens(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n    let values: MaybePromise[] = [];\n    for (const token of tokens) {\n      values = values.concat(callback.call(this, token));\n      switch (token.type) {\n        case 'table': {\n          const tableToken = token as Tokens.Table;\n          for (const cell of tableToken.header) {\n            values = values.concat(this.walkTokens(cell.tokens, callback));\n          }\n          for (const row of tableToken.rows) {\n            for (const cell of row) {\n              values = values.concat(this.walkTokens(cell.tokens, callback));\n            }\n          }\n          break;\n        }\n        case 'list': {\n          const listToken = token as Tokens.List;\n          values = values.concat(this.walkTokens(listToken.items, callback));\n          break;\n        }\n        default: {\n          const genericToken = token as Tokens.Generic;\n          if (this.defaults.extensions?.childTokens?.[genericToken.type]) {\n            this.defaults.extensions.childTokens[genericToken.type].forEach((childTokens) => {\n              const tokens = genericToken[childTokens].flat(Infinity) as Token[] | TokensList;\n              values = values.concat(this.walkTokens(tokens, callback));\n            });\n          } else if (genericToken.tokens) {\n            values = values.concat(this.walkTokens(genericToken.tokens, callback));\n          }\n        }\n      }\n    }\n    return values;\n  }\n\n  use(...args: MarkedExtension[]) {\n    const extensions: MarkedOptions['extensions'] = this.defaults.extensions || { renderers: {}, childTokens: {} };\n\n    args.forEach((pack) => {\n      // copy options to new object\n      const opts = { ...pack } as MarkedOptions;\n\n      // set async to true if it was set to true before\n      opts.async = this.defaults.async || opts.async || false;\n\n      // ==-- Parse \"addon\" extensions --== //\n      if (pack.extensions) {\n        pack.extensions.forEach((ext) => {\n          if (!ext.name) {\n            throw new Error('extension name required');\n          }\n          if ('renderer' in ext) { // Renderer extensions\n            const prevRenderer = extensions.renderers[ext.name];\n            if (prevRenderer) {\n              // Replace extension with func to run new extension but fall back if false\n              extensions.renderers[ext.name] = function(...args) {\n                let ret = ext.renderer.apply(this, args);\n                if (ret === false) {\n                  ret = prevRenderer.apply(this, args);\n                }\n                return ret;\n              };\n            } else {\n              extensions.renderers[ext.name] = ext.renderer;\n            }\n          }\n          if ('tokenizer' in ext) { // Tokenizer Extensions\n            if (!ext.level || (ext.level !== 'block' && ext.level !== 'inline')) {\n              throw new Error(\"extension level must be 'block' or 'inline'\");\n            }\n            const extLevel = extensions[ext.level];\n            if (extLevel) {\n              extLevel.unshift(ext.tokenizer);\n            } else {\n              extensions[ext.level] = [ext.tokenizer];\n            }\n            if (ext.start) { // Function to check for start of token\n              if (ext.level === 'block') {\n                if (extensions.startBlock) {\n                  extensions.startBlock.push(ext.start);\n                } else {\n                  extensions.startBlock = [ext.start];\n                }\n              } else if (ext.level === 'inline') {\n                if (extensions.startInline) {\n                  extensions.startInline.push(ext.start);\n                } else {\n                  extensions.startInline = [ext.start];\n                }\n              }\n            }\n          }\n          if ('childTokens' in ext && ext.childTokens) { // Child tokens to be visited by walkTokens\n            extensions.childTokens[ext.name] = ext.childTokens;\n          }\n        });\n        opts.extensions = extensions;\n      }\n\n      // ==-- Parse \"overwrite\" extensions --== //\n      if (pack.renderer) {\n        const renderer = this.defaults.renderer || new _Renderer(this.defaults);\n        for (const prop in pack.renderer) {\n          if (!(prop in renderer)) {\n            throw new Error(`renderer '${prop}' does not exist`);\n          }\n          if (['options', 'parser'].includes(prop)) {\n            // ignore options property\n            continue;\n          }\n          const rendererProp = prop as Exclude<keyof _Renderer, 'options' | 'parser'>;\n          const rendererFunc = pack.renderer[rendererProp] as GenericRendererFunction;\n          const prevRenderer = renderer[rendererProp] as GenericRendererFunction;\n          // Replace renderer with func to run extension, but fall back if false\n          renderer[rendererProp] = (...args: unknown[]) => {\n            let ret = rendererFunc.apply(renderer, args);\n            if (ret === false) {\n              ret = prevRenderer.apply(renderer, args);\n            }\n            return ret || '';\n          };\n        }\n        opts.renderer = renderer;\n      }\n      if (pack.tokenizer) {\n        const tokenizer = this.defaults.tokenizer || new _Tokenizer(this.defaults);\n        for (const prop in pack.tokenizer) {\n          if (!(prop in tokenizer)) {\n            throw new Error(`tokenizer '${prop}' does not exist`);\n          }\n          if (['options', 'rules', 'lexer'].includes(prop)) {\n            // ignore options, rules, and lexer properties\n            continue;\n          }\n          const tokenizerProp = prop as Exclude<keyof _Tokenizer, 'options' | 'rules' | 'lexer'>;\n          const tokenizerFunc = pack.tokenizer[tokenizerProp] as UnknownFunction;\n          const prevTokenizer = tokenizer[tokenizerProp] as UnknownFunction;\n          // Replace tokenizer with func to run extension, but fall back if false\n          // @ts-expect-error cannot type tokenizer function dynamically\n          tokenizer[tokenizerProp] = (...args: unknown[]) => {\n            let ret = tokenizerFunc.apply(tokenizer, args);\n            if (ret === false) {\n              ret = prevTokenizer.apply(tokenizer, args);\n            }\n            return ret;\n          };\n        }\n        opts.tokenizer = tokenizer;\n      }\n\n      // ==-- Parse Hooks extensions --== //\n      if (pack.hooks) {\n        const hooks = this.defaults.hooks || new _Hooks();\n        for (const prop in pack.hooks) {\n          if (!(prop in hooks)) {\n            throw new Error(`hook '${prop}' does not exist`);\n          }\n          if (['options', 'block'].includes(prop)) {\n            // ignore options and block properties\n            continue;\n          }\n          const hooksProp = prop as Exclude<keyof _Hooks, 'options' | 'block'>;\n          const hooksFunc = pack.hooks[hooksProp] as UnknownFunction;\n          const prevHook = hooks[hooksProp] as UnknownFunction;\n          if (_Hooks.passThroughHooks.has(prop)) {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (arg: unknown) => {\n              if (this.defaults.async) {\n                return Promise.resolve(hooksFunc.call(hooks, arg)).then(ret => {\n                  return prevHook.call(hooks, ret);\n                });\n              }\n\n              const ret = hooksFunc.call(hooks, arg);\n              return prevHook.call(hooks, ret);\n            };\n          } else {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (...args: unknown[]) => {\n              let ret = hooksFunc.apply(hooks, args);\n              if (ret === false) {\n                ret = prevHook.apply(hooks, args);\n              }\n              return ret;\n            };\n          }\n        }\n        opts.hooks = hooks;\n      }\n\n      // ==-- Parse WalkTokens extensions --== //\n      if (pack.walkTokens) {\n        const walkTokens = this.defaults.walkTokens;\n        const packWalktokens = pack.walkTokens;\n        opts.walkTokens = function(token) {\n          let values: MaybePromise[] = [];\n          values.push(packWalktokens.call(this, token));\n          if (walkTokens) {\n            values = values.concat(walkTokens.call(this, token));\n          }\n          return values;\n        };\n      }\n\n      this.defaults = { ...this.defaults, ...opts };\n    });\n\n    return this;\n  }\n\n  setOptions(opt: MarkedOptions) {\n    this.defaults = { ...this.defaults, ...opt };\n    return this;\n  }\n\n  lexer(src: string, options?: MarkedOptions) {\n    return _Lexer.lex(src, options ?? this.defaults);\n  }\n\n  parser(tokens: Token[], options?: MarkedOptions) {\n    return _Parser.parse(tokens, options ?? this.defaults);\n  }\n\n  private parseMarkdown(blockType: boolean) {\n    type overloadedParse = {\n      (src: string, options: MarkedOptions & { async: true }): Promise<string>;\n      (src: string, options: MarkedOptions & { async: false }): string;\n      (src: string, options?: MarkedOptions | null): string | Promise<string>;\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parse: overloadedParse = (src: string, options?: MarkedOptions | null): any => {\n      const origOpt = { ...options };\n      const opt = { ...this.defaults, ...origOpt };\n\n      const throwError = this.onError(!!opt.silent, !!opt.async);\n\n      // throw error if an extension set async to true but parse was called with async: false\n      if (this.defaults.async === true && origOpt.async === false) {\n        return throwError(new Error('marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise.'));\n      }\n\n      // throw error in case of non string input\n      if (typeof src === 'undefined' || src === null) {\n        return throwError(new Error('marked(): input parameter is undefined or null'));\n      }\n      if (typeof src !== 'string') {\n        return throwError(new Error('marked(): input parameter is of type '\n          + Object.prototype.toString.call(src) + ', string expected'));\n      }\n\n      if (opt.hooks) {\n        opt.hooks.options = opt;\n        opt.hooks.block = blockType;\n      }\n\n      const lexer = opt.hooks ? opt.hooks.provideLexer() : (blockType ? _Lexer.lex : _Lexer.lexInline);\n      const parser = opt.hooks ? opt.hooks.provideParser() : (blockType ? _Parser.parse : _Parser.parseInline);\n\n      if (opt.async) {\n        return Promise.resolve(opt.hooks ? opt.hooks.preprocess(src) : src)\n          .then(src => lexer(src, opt))\n          .then(tokens => opt.hooks ? opt.hooks.processAllTokens(tokens) : tokens)\n          .then(tokens => opt.walkTokens ? Promise.all(this.walkTokens(tokens, opt.walkTokens)).then(() => tokens) : tokens)\n          .then(tokens => parser(tokens, opt))\n          .then(html => opt.hooks ? opt.hooks.postprocess(html) : html)\n          .catch(throwError);\n      }\n\n      try {\n        if (opt.hooks) {\n          src = opt.hooks.preprocess(src) as string;\n        }\n        let tokens = lexer(src, opt);\n        if (opt.hooks) {\n          tokens = opt.hooks.processAllTokens(tokens);\n        }\n        if (opt.walkTokens) {\n          this.walkTokens(tokens, opt.walkTokens);\n        }\n        let html = parser(tokens, opt);\n        if (opt.hooks) {\n          html = opt.hooks.postprocess(html) as string;\n        }\n        return html;\n      } catch (e) {\n        return throwError(e as Error);\n      }\n    };\n\n    return parse;\n  }\n\n  private onError(silent: boolean, async: boolean) {\n    return (e: Error): string | Promise<string> => {\n      e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n\n      if (silent) {\n        const msg = '<p>An error occurred:</p><pre>'\n          + escape(e.message + '', true)\n          + '</pre>';\n        if (async) {\n          return Promise.resolve(msg);\n        }\n        return msg;\n      }\n\n      if (async) {\n        return Promise.reject(e);\n      }\n      throw e;\n    };\n  }\n}\n", "import { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport { _Tokenizer } from './Tokenizer.ts';\nimport { _Renderer } from './Renderer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { _Hooks } from './Hooks.ts';\nimport { Marked } from './Instance.ts';\nimport {\n  _getDefaults,\n  changeDefaults,\n  _defaults,\n} from './defaults.ts';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, TokensList } from './Tokens.ts';\nimport type { MaybePromise } from './Instance.ts';\n\nconst markedInstance = new Marked();\n\n/**\n * Compiles markdown to HTML asynchronously.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options, having async: true\n * @return Promise of string of compiled HTML\n */\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\n\n/**\n * Compiles markdown to HTML.\n *\n * @param src String of markdown source to be compiled\n * @param options Optional hash of options\n * @return String of compiled HTML. Will be a Promise of string if async is set to true by any extensions.\n */\nexport function marked(src: string, options: MarkedOptions & { async: false }): string;\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\nexport function marked(src: string, options?: MarkedOptions | null): string | Promise<string>;\nexport function marked(src: string, opt?: MarkedOptions | null): string | Promise<string> {\n  return markedInstance.parse(src, opt);\n}\n\n/**\n * Sets the default options.\n *\n * @param options Hash of options\n */\nmarked.options =\nmarked.setOptions = function(options: MarkedOptions) {\n  markedInstance.setOptions(options);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Gets the original marked default options.\n */\nmarked.getDefaults = _getDefaults;\n\nmarked.defaults = _defaults;\n\n/**\n * Use Extension\n */\n\nmarked.use = function(...args: MarkedExtension[]) {\n  markedInstance.use(...args);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Run callback for every token\n */\n\nmarked.walkTokens = function(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n  return markedInstance.walkTokens(tokens, callback);\n};\n\n/**\n * Compiles markdown to HTML without enclosing `p` tag.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options\n * @return String of compiled HTML\n */\nmarked.parseInline = markedInstance.parseInline;\n\n/**\n * Expose\n */\nmarked.Parser = _Parser;\nmarked.parser = _Parser.parse;\nmarked.Renderer = _Renderer;\nmarked.TextRenderer = _TextRenderer;\nmarked.Lexer = _Lexer;\nmarked.lexer = _Lexer.lex;\nmarked.Tokenizer = _Tokenizer;\nmarked.Hooks = _Hooks;\nmarked.parse = marked;\n\nexport const options = marked.options;\nexport const setOptions = marked.setOptions;\nexport const use = marked.use;\nexport const walkTokens = marked.walkTokens;\nexport const parseInline = marked.parseInline;\nexport const parse = marked;\nexport const parser = _Parser.parse;\nexport const lexer = _Lexer.lex;\nexport { _defaults as defaults, _getDefaults as getDefaults } from './defaults.ts';\nexport { _Lexer as Lexer } from './Lexer.ts';\nexport { _Parser as Parser } from './Parser.ts';\nexport { _Tokenizer as Tokenizer } from './Tokenizer.ts';\nexport { _Renderer as Renderer } from './Renderer.ts';\nexport { _TextRenderer as TextRenderer } from './TextRenderer.ts';\nexport { _Hooks as Hooks } from './Hooks.ts';\nexport { Marked } from './Instance.ts';\nexport type * from './MarkedOptions.ts';\nexport type * from './Tokens.ts';\n", "/**\r\n * DOM utilities and RTL detection\r\n *\r\n * This module uses Shadow DOM for complete CSS isolation from the host page.\r\n */\r\n\r\nconst WIDGET_CONTAINER_ID = 'chat-widget-container';\r\n\r\n// Store reference to shadow root for internal access\r\nlet shadowRoot: ShadowRoot | null = null;\r\nlet widgetRoot: HTMLElement | null = null;\r\n\r\n/**\r\n * Create the main widget container with Shadow DOM\r\n *\r\n * Shadow DOM provides complete CSS encapsulation:\r\n * - Host page CSS cannot affect widget styles\r\n * - Widget CSS cannot leak out to the host page\r\n * - No class name conflicts possible\r\n */\r\nexport function createContainer(): HTMLElement {\r\n  // Remove existing container if present\r\n  const existing = document.getElementById(WIDGET_CONTAINER_ID);\r\n  if (existing) {\r\n    existing.remove();\r\n  }\r\n\r\n  // Create host element (this is what the page sees)\r\n  const host = document.createElement('div');\r\n  host.id = WIDGET_CONTAINER_ID;\r\n  host.setAttribute('role', 'complementary');\r\n  host.setAttribute('aria-label', 'AI Chat Widget');\r\n\r\n  // Apply host styles directly (these must be on the light DOM element)\r\n  // Using inline styles to avoid any host page CSS conflicts\r\n  host.style.cssText = `\r\n    position: fixed !important;\r\n    z-index: 99999 !important;\r\n    top: 0 !important;\r\n    left: 0 !important;\r\n    width: 0 !important;\r\n    height: 0 !important;\r\n    overflow: visible !important;\r\n    pointer-events: none !important;\r\n  `;\r\n\r\n  // Create shadow root for style encapsulation\r\n  shadowRoot = host.attachShadow({ mode: 'open' });\r\n\r\n  // Create inner container for widget content\r\n  widgetRoot = document.createElement('div');\r\n  widgetRoot.className = 'chat-widget-root';\r\n  shadowRoot.appendChild(widgetRoot);\r\n\r\n  document.body.appendChild(host);\r\n  return widgetRoot;\r\n}\r\n\r\n/**\r\n * Inject widget styles into the Shadow DOM\r\n *\r\n * Styles are injected directly into the shadow root, ensuring\r\n * they only affect elements within the widget.\r\n */\r\nexport function injectStyles(css: string): void {\r\n  if (!shadowRoot) {\r\n    console.warn('[ChatWidget] Cannot inject styles: Shadow root not initialized');\r\n    return;\r\n  }\r\n\r\n  // Check for existing style element\r\n  let styleElement = shadowRoot.querySelector('style');\r\n\r\n  if (!styleElement) {\r\n    styleElement = document.createElement('style');\r\n    // Insert styles before content\r\n    shadowRoot.insertBefore(styleElement, shadowRoot.firstChild);\r\n  }\r\n\r\n  styleElement.textContent = css;\r\n}\r\n\r\n/**\r\n * Get the shadow root for advanced operations\r\n */\r\nexport function getShadowRoot(): ShadowRoot | null {\r\n  return shadowRoot;\r\n}\r\n\r\n/**\r\n * Get the widget root element inside shadow DOM\r\n */\r\nexport function getWidgetRoot(): HTMLElement | null {\r\n  return widgetRoot;\r\n}\r\n\r\n/**\r\n * Remove widget from DOM\r\n */\r\nexport function destroyWidget(): void {\r\n  const container = document.getElementById(WIDGET_CONTAINER_ID);\r\n  container?.remove();\r\n  shadowRoot = null;\r\n  widgetRoot = null;\r\n}\r\n\r\n/**\r\n * RTL Unicode ranges for detection\r\n */\r\nconst RTL_REGEX = /[\\u0591-\\u07FF\\u200F\\u202B\\u202E\\uFB1D-\\uFDFD\\uFE70-\\uFEFC]/;\r\n\r\n/**\r\n * Detect if text contains RTL characters\r\n */\r\nexport function detectRTL(text: string): boolean {\r\n  return RTL_REGEX.test(text);\r\n}\r\n\r\n/**\r\n * Set text direction on an element based on content\r\n */\r\nexport function setTextDirection(element: HTMLElement, text: string): void {\r\n  if (detectRTL(text)) {\r\n    element.setAttribute('dir', 'rtl');\r\n  } else {\r\n    element.setAttribute('dir', 'ltr');\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\nexport function escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Generate a unique ID\r\n */\r\nexport function generateId(): string {\r\n  return `${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\r\n}\r\n\r\n/**\r\n * Check if user prefers reduced motion\r\n */\r\nexport function prefersReducedMotion(): boolean {\r\n  return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n}\r\n\r\n/**\r\n * Check if the device is mobile\r\n */\r\nexport function isMobile(): boolean {\r\n  return window.matchMedia('(max-width: 768px)').matches;\r\n}\r\n\r\n/**\r\n * Scroll element to bottom\r\n */\r\nexport function scrollToBottom(element: HTMLElement): void {\r\n  requestAnimationFrame(() => {\r\n    element.scrollTop = element.scrollHeight;\r\n  });\r\n}\r\n\r\n/**\r\n * Focus trap for accessibility\r\n * Works within Shadow DOM context\r\n */\r\nexport function createFocusTrap(container: HTMLElement): {\r\n  activate: () => void;\r\n  deactivate: () => void;\r\n} {\r\n  const focusableSelector = 'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])';\r\n  let previousActiveElement: HTMLElement | null = null;\r\n\r\n  function getFocusableElements(): HTMLElement[] {\r\n    return Array.from(container.querySelectorAll(focusableSelector)) as HTMLElement[];\r\n  }\r\n\r\n  function handleKeyDown(event: KeyboardEvent): void {\r\n    if (event.key !== 'Tab') return;\r\n\r\n    const focusable = getFocusableElements();\r\n    if (focusable.length === 0) return;\r\n\r\n    const first = focusable[0];\r\n    const last = focusable[focusable.length - 1];\r\n\r\n    // Get active element - check shadow root first\r\n    const activeElement = shadowRoot?.activeElement || document.activeElement;\r\n\r\n    if (event.shiftKey && activeElement === first) {\r\n      event.preventDefault();\r\n      last.focus();\r\n    } else if (!event.shiftKey && activeElement === last) {\r\n      event.preventDefault();\r\n      first.focus();\r\n    }\r\n  }\r\n\r\n  return {\r\n    activate() {\r\n      previousActiveElement = document.activeElement as HTMLElement;\r\n      container.addEventListener('keydown', handleKeyDown);\r\n      const focusable = getFocusableElements();\r\n      if (focusable.length > 0) {\r\n        focusable[0].focus();\r\n      }\r\n    },\r\n    deactivate() {\r\n      container.removeEventListener('keydown', handleKeyDown);\r\n      if (previousActiveElement) {\r\n        previousActiveElement.focus();\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Announce message for screen readers\r\n * Creates element in light DOM for better screen reader compatibility\r\n */\r\nexport function announceToScreenReader(message: string): void {\r\n  const announcer = document.createElement('div');\r\n  announcer.setAttribute('aria-live', 'polite');\r\n  announcer.setAttribute('aria-atomic', 'true');\r\n  announcer.className = 'chat-widget-sr-only';\r\n  announcer.style.cssText = `\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    padding: 0;\r\n    margin: -1px;\r\n    overflow: hidden;\r\n    clip: rect(0, 0, 0, 0);\r\n    white-space: nowrap;\r\n    border: 0;\r\n  `;\r\n\r\n  // Append to body (light DOM) for screen reader compatibility\r\n  document.body.appendChild(announcer);\r\n\r\n  // Delay to ensure screen reader picks up the change\r\n  setTimeout(() => {\r\n    announcer.textContent = message;\r\n  }, 100);\r\n\r\n  // Clean up after announcement\r\n  setTimeout(() => {\r\n    announcer.remove();\r\n  }, 1000);\r\n}\r\n", "/**\r\n * Markdown rendering with syntax highlighting\r\n */\r\n\r\nimport { marked, type MarkedOptions } from 'marked';\r\nimport type { ChatWidgetConfig } from '../types';\r\nimport { escapeHtml } from './dom';\r\n\r\n// Simple syntax highlighting without external dependencies\r\nconst HIGHLIGHT_KEYWORDS: Record<string, string[]> = {\r\n  keyword: [\r\n    'const', 'let', 'var', 'function', 'return', 'if', 'else', 'for', 'while', 'do',\r\n    'switch', 'case', 'break', 'continue', 'try', 'catch', 'finally', 'throw',\r\n    'class', 'extends', 'new', 'this', 'super', 'import', 'export', 'from', 'as',\r\n    'default', 'async', 'await', 'yield', 'static', 'get', 'set', 'typeof', 'instanceof',\r\n    'in', 'of', 'delete', 'void', 'null', 'undefined', 'true', 'false',\r\n    'def', 'print', 'elif', 'except', 'pass', 'with', 'lambda', 'global', 'nonlocal',\r\n    'raise', 'assert', 'and', 'or', 'not', 'is', 'None', 'True', 'False',\r\n  ],\r\n  type: [\r\n    'string', 'number', 'boolean', 'object', 'array', 'any', 'void', 'never',\r\n    'int', 'float', 'str', 'list', 'dict', 'tuple', 'set', 'bool',\r\n    'String', 'Number', 'Boolean', 'Object', 'Array', 'Promise', 'Map', 'Set',\r\n  ],\r\n  builtin: [\r\n    'console', 'window', 'document', 'Math', 'JSON', 'Date', 'Error',\r\n    'setTimeout', 'setInterval', 'fetch', 'require', 'module', 'exports',\r\n    'len', 'range', 'enumerate', 'zip', 'map', 'filter', 'sorted', 'reversed',\r\n    'input', 'open', 'type', 'isinstance', 'hasattr', 'getattr', 'setattr',\r\n  ],\r\n};\r\n\r\n/**\r\n * Simple syntax highlighter\r\n */\r\nfunction highlightCode(code: string, language: string): string {\r\n  const escaped = escapeHtml(code);\r\n\r\n  if (!language || language === 'text' || language === 'plaintext') {\r\n    return escaped;\r\n  }\r\n\r\n  let result = escaped;\r\n\r\n  // Highlight strings (single and double quotes)\r\n  result = result.replace(\r\n    /([\"'`])(?:(?!\\1)[^\\\\]|\\\\.)*\\1/g,\r\n    '<span class=\"chat-widget-hl-string\">$&</span>'\r\n  );\r\n\r\n  // Highlight comments (single line // and #, and multi-line /* */)\r\n  result = result.replace(\r\n    /(\\/\\/[^\\n]*|#[^\\n]*|\\/\\*[\\s\\S]*?\\*\\/)/g,\r\n    '<span class=\"chat-widget-hl-comment\">$&</span>'\r\n  );\r\n\r\n  // Highlight numbers\r\n  result = result.replace(\r\n    /\\b(\\d+\\.?\\d*)\\b/g,\r\n    '<span class=\"chat-widget-hl-number\">$1</span>'\r\n  );\r\n\r\n  // Highlight keywords\r\n  const keywordPattern = new RegExp(`\\\\b(${HIGHLIGHT_KEYWORDS.keyword.join('|')})\\\\b`, 'g');\r\n  result = result.replace(keywordPattern, '<span class=\"chat-widget-hl-keyword\">$1</span>');\r\n\r\n  // Highlight types\r\n  const typePattern = new RegExp(`\\\\b(${HIGHLIGHT_KEYWORDS.type.join('|')})\\\\b`, 'g');\r\n  result = result.replace(typePattern, '<span class=\"chat-widget-hl-type\">$1</span>');\r\n\r\n  // Highlight builtins\r\n  const builtinPattern = new RegExp(`\\\\b(${HIGHLIGHT_KEYWORDS.builtin.join('|')})\\\\b`, 'g');\r\n  result = result.replace(builtinPattern, '<span class=\"chat-widget-hl-builtin\">$1</span>');\r\n\r\n  return result;\r\n}\r\n\r\nexport class MarkdownService {\r\n  private config: ChatWidgetConfig;\r\n  private markedInstance: typeof marked;\r\n\r\n  constructor(config: ChatWidgetConfig) {\r\n    this.config = config;\r\n    this.markedInstance = marked;\r\n    this.initializeMarked();\r\n  }\r\n\r\n  private initializeMarked(): void {\r\n    const options: MarkedOptions = {\r\n      gfm: true,\r\n      breaks: true,\r\n      async: false,\r\n    };\r\n\r\n    this.markedInstance.setOptions(options);\r\n\r\n    // Custom renderer for code blocks and security\r\n    const renderer = new marked.Renderer();\r\n\r\n    // Code blocks with syntax highlighting and copy button\r\n    renderer.code = ({ text, lang }: { text: string; lang?: string }) => {\r\n      const language = lang || 'text';\r\n      const highlighted = this.config.syntaxHighlighting\r\n        ? highlightCode(text, language)\r\n        : escapeHtml(text);\r\n\r\n      const langLabel = language !== 'text' ? `<span class=\"chat-widget-code-lang\">${escapeHtml(language)}</span>` : '';\r\n      const copyBtn = `<button class=\"chat-widget-code-copy\" aria-label=\"Copy code\" title=\"Copy code\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\r\n          <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\r\n        </svg>\r\n      </button>`;\r\n\r\n      return `<div class=\"chat-widget-code-block\">\r\n        <div class=\"chat-widget-code-header\">${langLabel}${copyBtn}</div>\r\n        <pre><code class=\"language-${escapeHtml(language)}\">${highlighted}</code></pre>\r\n      </div>`;\r\n    };\r\n\r\n    // Inline code\r\n    renderer.codespan = ({ text }: { text: string }) => {\r\n      return `<code class=\"chat-widget-inline-code\">${escapeHtml(text)}</code>`;\r\n    };\r\n\r\n    // Links - open in new tab with security attributes\r\n    renderer.link = ({ href, title, text }: { href: string; title?: string | null; text: string }) => {\r\n      // Only allow safe protocols\r\n      const safeProtocols = ['http:', 'https:', 'mailto:'];\r\n      let safeHref = '#';\r\n\r\n      try {\r\n        const url = new URL(href, window.location.origin);\r\n        if (safeProtocols.includes(url.protocol)) {\r\n          safeHref = href;\r\n        }\r\n      } catch {\r\n        // Invalid URL, keep as #\r\n      }\r\n\r\n      const titleAttr = title ? ` title=\"${escapeHtml(title)}\"` : '';\r\n      return `<a href=\"${escapeHtml(safeHref)}\" target=\"_blank\" rel=\"noopener noreferrer\"${titleAttr}>${text}</a>`;\r\n    };\r\n\r\n    // Images with max-width\r\n    renderer.image = ({ href, title, text }: { href: string; title?: string | null; text: string }) => {\r\n      const titleAttr = title ? ` title=\"${escapeHtml(title)}\"` : '';\r\n      return `<img src=\"${escapeHtml(href)}\" alt=\"${escapeHtml(text)}\"${titleAttr} class=\"chat-widget-image\" loading=\"lazy\">`;\r\n    };\r\n\r\n    // Task list items\r\n    renderer.listitem = ({ text, task, checked }: { text: string; task: boolean; checked?: boolean }) => {\r\n      if (task) {\r\n        const checkbox = checked\r\n          ? '<span class=\"chat-widget-checkbox chat-widget-checkbox--checked\">&#x2611;</span>'\r\n          : '<span class=\"chat-widget-checkbox\">&#x2610;</span>';\r\n        return `<li class=\"chat-widget-task-item\">${checkbox}${text}</li>`;\r\n      }\r\n      return `<li>${text}</li>`;\r\n    };\r\n\r\n    this.markedInstance.use({ renderer });\r\n  }\r\n\r\n  /**\r\n   * Render markdown content\r\n   */\r\n  render(content: string): string {\r\n    if (!this.config.enableMarkdown) {\r\n      return this.renderPlainText(content);\r\n    }\r\n\r\n    try {\r\n      const html = this.markedInstance.parse(content) as string;\r\n      return `<div class=\"chat-widget-markdown\">${html}</div>`;\r\n    } catch (error) {\r\n      console.warn('[ChatWidget] Markdown parsing failed:', error);\r\n      return this.renderPlainText(content);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render markdown progressively for streaming\r\n   * Handles incomplete code blocks and other edge cases\r\n   */\r\n  renderProgressive(content: string, isComplete: boolean): string {\r\n    if (!this.config.enableMarkdown) {\r\n      return this.renderPlainText(content);\r\n    }\r\n\r\n    let processedContent = content;\r\n\r\n    // Check for incomplete code blocks\r\n    const codeBlockCount = (content.match(/```/g) || []).length;\r\n    const isIncompleteCodeBlock = codeBlockCount % 2 !== 0;\r\n\r\n    if (isIncompleteCodeBlock && !isComplete) {\r\n      // Find the last incomplete code block and temporarily close it\r\n      const lastCodeBlockStart = content.lastIndexOf('```');\r\n      const afterCodeFence = content.substring(lastCodeBlockStart);\r\n\r\n      // Check if there's content after the opening fence\r\n      if (!afterCodeFence.includes('\\n```')) {\r\n        // Add a temporary closing fence for rendering\r\n        processedContent = content + '\\n```';\r\n      }\r\n    }\r\n\r\n    try {\r\n      const html = this.markedInstance.parse(processedContent) as string;\r\n      return `<div class=\"chat-widget-markdown\">${html}</div>`;\r\n    } catch (error) {\r\n      return this.renderPlainText(content);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render plain text with line breaks preserved\r\n   */\r\n  private renderPlainText(content: string): string {\r\n    return `<div class=\"chat-widget-plaintext\">${escapeHtml(content).replace(/\\n/g, '<br>')}</div>`;\r\n  }\r\n\r\n  /**\r\n   * Render user message (plain text, no markdown)\r\n   */\r\n  renderUserMessage(content: string): string {\r\n    return this.renderPlainText(content);\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize copy functionality for code blocks\r\n * Should be called after rendering messages\r\n */\r\nexport function initCodeCopyButtons(container: HTMLElement): void {\r\n  container.querySelectorAll('.chat-widget-code-copy').forEach((button) => {\r\n    button.addEventListener('click', async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      const codeBlock = button.closest('.chat-widget-code-block');\r\n      const code = codeBlock?.querySelector('code')?.textContent;\r\n\r\n      if (code) {\r\n        try {\r\n          await navigator.clipboard.writeText(code);\r\n\r\n          // Visual feedback\r\n          button.classList.add('chat-widget-code-copy--success');\r\n          setTimeout(() => {\r\n            button.classList.remove('chat-widget-code-copy--success');\r\n          }, 2000);\r\n        } catch (err) {\r\n          console.warn('[ChatWidget] Failed to copy code:', err);\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n", "/**\r\n * Session management with localStorage persistence\r\n */\r\n\r\nimport type { ChatSession, Message, ChatWidgetConfig } from '../types';\r\nimport { generateId } from './dom';\r\n\r\nexport class SessionService {\r\n  private config: ChatWidgetConfig;\r\n  private session: ChatSession | null = null;\r\n\r\n  constructor(config: ChatWidgetConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  /**\r\n   * Initialize or restore session\r\n   */\r\n  initialize(): ChatSession {\r\n    if (this.config.persistSession) {\r\n      const stored = this.loadFromStorage();\r\n      if (stored) {\r\n        this.session = stored;\r\n        return stored;\r\n      }\r\n    }\r\n\r\n    this.session = this.createNew();\r\n    this.save();\r\n    return this.session;\r\n  }\r\n\r\n  /**\r\n   * Get current session\r\n   */\r\n  getSession(): ChatSession {\r\n    if (!this.session) {\r\n      return this.initialize();\r\n    }\r\n    return this.session;\r\n  }\r\n\r\n  /**\r\n   * Get conversation ID for API calls\r\n   */\r\n  getConversationId(): string {\r\n    return this.getSession().conversationId;\r\n  }\r\n\r\n  /**\r\n   * Get all messages\r\n   */\r\n  getMessages(): Message[] {\r\n    return this.getSession().messages;\r\n  }\r\n\r\n  /**\r\n   * Add a new message\r\n   */\r\n  addMessage(message: Message): void {\r\n    if (!this.session) {\r\n      this.initialize();\r\n    }\r\n\r\n    this.session!.messages.push(message);\r\n    this.session!.updatedAt = Date.now();\r\n    this.save();\r\n  }\r\n\r\n  /**\r\n   * Update an existing message\r\n   */\r\n  updateMessage(id: string, updates: Partial<Message>): void {\r\n    if (!this.session) return;\r\n\r\n    const index = this.session.messages.findIndex((m) => m.id === id);\r\n    if (index !== -1) {\r\n      this.session.messages[index] = {\r\n        ...this.session.messages[index],\r\n        ...updates,\r\n      };\r\n      this.session.updatedAt = Date.now();\r\n      this.save();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a message by ID\r\n   */\r\n  getMessage(id: string): Message | undefined {\r\n    return this.session?.messages.find((m) => m.id === id);\r\n  }\r\n\r\n  /**\r\n   * Clear all messages and start fresh\r\n   */\r\n  clear(): void {\r\n    this.session = this.createNew();\r\n    this.save();\r\n  }\r\n\r\n  /**\r\n   * Create a new session\r\n   */\r\n  private createNew(): ChatSession {\r\n    return {\r\n      id: generateId(),\r\n      conversationId: generateId(),\r\n      messages: [],\r\n      createdAt: Date.now(),\r\n      updatedAt: Date.now(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Save session to localStorage\r\n   */\r\n  private save(): void {\r\n    if (!this.config.persistSession || !this.session) return;\r\n\r\n    try {\r\n      localStorage.setItem(this.config.sessionStorageKey, JSON.stringify(this.session));\r\n    } catch (e) {\r\n      console.warn('[ChatWidget] Failed to save session:', e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load session from localStorage\r\n   */\r\n  private loadFromStorage(): ChatSession | null {\r\n    try {\r\n      const data = localStorage.getItem(this.config.sessionStorageKey);\r\n      if (data) {\r\n        const session = JSON.parse(data) as ChatSession;\r\n\r\n        // Validate session structure\r\n        if (this.isValidSession(session)) {\r\n          return session;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.warn('[ChatWidget] Failed to load session:', e);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Validate session structure\r\n   */\r\n  private isValidSession(obj: unknown): obj is ChatSession {\r\n    if (!obj || typeof obj !== 'object') return false;\r\n\r\n    const session = obj as Record<string, unknown>;\r\n\r\n    return (\r\n      typeof session.id === 'string' &&\r\n      typeof session.conversationId === 'string' &&\r\n      Array.isArray(session.messages) &&\r\n      typeof session.createdAt === 'number' &&\r\n      typeof session.updatedAt === 'number'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a new user message\r\n   */\r\n  createUserMessage(content: string): Message {\r\n    return {\r\n      id: generateId(),\r\n      role: 'user',\r\n      content,\r\n      timestamp: Date.now(),\r\n      status: 'complete',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a new assistant message placeholder\r\n   */\r\n  createAssistantMessage(): Message {\r\n    return {\r\n      id: generateId(),\r\n      role: 'assistant',\r\n      content: '',\r\n      timestamp: Date.now(),\r\n      status: 'streaming',\r\n    };\r\n  }\r\n}\r\n", "/**\r\n * Page Context Service - Extracts readable content from the current page\r\n */\r\n\r\nimport type { ChatWidgetConfig } from '../types';\r\n\r\nexport class PageContextService {\r\n  private config: ChatWidgetConfig;\r\n\r\n  constructor(config: ChatWidgetConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  /**\r\n   * Extract page context as a readable text summary\r\n   */\r\n  extractContext(): string | null {\r\n    if (!this.config.includePageContext) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      // Determine what element to extract from\r\n      let rootElement: Element | null = document.body;\r\n\r\n      if (this.config.pageContextSelector) {\r\n        rootElement = document.querySelector(this.config.pageContextSelector);\r\n        if (!rootElement) {\r\n          console.warn(`[ChatWidget] pageContextSelector \"${this.config.pageContextSelector}\" not found`);\r\n          rootElement = document.body;\r\n        }\r\n      }\r\n\r\n      // Extract structured content\r\n      const context = this.extractFromElement(rootElement);\r\n\r\n      // Truncate if too long (keep under ~8000 chars to leave room for conversation)\r\n      const maxLength = 8000;\r\n      if (context.length > maxLength) {\r\n        return context.substring(0, maxLength) + '\\n\\n[Content truncated...]';\r\n      }\r\n\r\n      return context;\r\n    } catch (error) {\r\n      console.error('[ChatWidget] Error extracting page context:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extract readable content from an element\r\n   */\r\n  private extractFromElement(element: Element): string {\r\n    const parts: string[] = [];\r\n\r\n    // Page title\r\n    const title = document.title;\r\n    if (title) {\r\n      parts.push(`Page Title: ${title}`);\r\n    }\r\n\r\n    // Current URL (without query params for privacy)\r\n    const url = window.location.origin + window.location.pathname;\r\n    parts.push(`URL: ${url}`);\r\n\r\n    parts.push('');\r\n    parts.push('--- Page Content ---');\r\n    parts.push('');\r\n\r\n    // Extract content recursively\r\n    const content = this.extractTextContent(element);\r\n    parts.push(content);\r\n\r\n    // Extract any data tables\r\n    const tables = this.extractTables(element);\r\n    if (tables) {\r\n      parts.push('');\r\n      parts.push('--- Data Tables ---');\r\n      parts.push(tables);\r\n    }\r\n\r\n    // Extract form fields and their values\r\n    const forms = this.extractForms(element);\r\n    if (forms) {\r\n      parts.push('');\r\n      parts.push('--- Form Fields ---');\r\n      parts.push(forms);\r\n    }\r\n\r\n    return parts.join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Extract text content, preserving structure\r\n   */\r\n  private extractTextContent(element: Element): string {\r\n    const lines: string[] = [];\r\n    const skipTags = new Set(['SCRIPT', 'STYLE', 'NOSCRIPT', 'SVG', 'PATH', 'IFRAME', 'TEMPLATE']);\r\n    const skipClasses = ['chat-widget', 'chatwidget'];\r\n\r\n    const walk = (node: Node, depth: number = 0) => {\r\n      if (node.nodeType === Node.ELEMENT_NODE) {\r\n        const el = node as Element;\r\n\r\n        // Skip chat widget elements\r\n        if (skipTags.has(el.tagName)) return;\r\n        if (el.id?.toLowerCase().includes('chat-widget')) return;\r\n        if (skipClasses.some(cls => el.className?.toString().toLowerCase().includes(cls))) return;\r\n\r\n        // Handle specific elements\r\n        const tag = el.tagName;\r\n\r\n        // Headings\r\n        if (/^H[1-6]$/.test(tag)) {\r\n          const level = parseInt(tag[1]);\r\n          const prefix = '#'.repeat(level);\r\n          const text = el.textContent?.trim();\r\n          if (text) {\r\n            lines.push('');\r\n            lines.push(`${prefix} ${text}`);\r\n          }\r\n          return; // Don't recurse into headings\r\n        }\r\n\r\n        // Lists\r\n        if (tag === 'LI') {\r\n          const text = this.getDirectText(el);\r\n          if (text) {\r\n            lines.push(`  \u2022 ${text}`);\r\n          }\r\n        }\r\n\r\n        // Links\r\n        if (tag === 'A') {\r\n          const text = el.textContent?.trim();\r\n          const href = el.getAttribute('href');\r\n          if (text && href && !href.startsWith('#') && !href.startsWith('javascript:')) {\r\n            lines.push(`[${text}]`);\r\n          }\r\n          return;\r\n        }\r\n\r\n        // Paragraphs and divs with direct text\r\n        if (tag === 'P' || tag === 'DIV' || tag === 'SPAN') {\r\n          const text = this.getDirectText(el);\r\n          if (text && text.length > 10) {\r\n            lines.push(text);\r\n          }\r\n        }\r\n\r\n        // Recurse into children\r\n        for (const child of el.childNodes) {\r\n          walk(child, depth + 1);\r\n        }\r\n      } else if (node.nodeType === Node.TEXT_NODE) {\r\n        // Text nodes are handled by their parent elements\r\n      }\r\n    };\r\n\r\n    walk(element);\r\n\r\n    // Clean up and dedupe\r\n    return lines\r\n      .filter(line => line.trim().length > 0)\r\n      .filter((line, idx, arr) => arr.indexOf(line) === idx) // Remove exact duplicates\r\n      .join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Get direct text content (not from children)\r\n   */\r\n  private getDirectText(element: Element): string {\r\n    let text = '';\r\n    for (const child of element.childNodes) {\r\n      if (child.nodeType === Node.TEXT_NODE) {\r\n        text += child.textContent;\r\n      }\r\n    }\r\n    return text.trim();\r\n  }\r\n\r\n  /**\r\n   * Extract tables as markdown\r\n   */\r\n  private extractTables(element: Element): string | null {\r\n    const tables = element.querySelectorAll('table');\r\n    if (tables.length === 0) return null;\r\n\r\n    const parts: string[] = [];\r\n\r\n    tables.forEach((table, tableIdx) => {\r\n      // Skip tables inside chat widget\r\n      if (table.closest('#chat-widget-container')) return;\r\n\r\n      const rows = table.querySelectorAll('tr');\r\n      if (rows.length === 0) return;\r\n\r\n      parts.push(`\\nTable ${tableIdx + 1}:`);\r\n\r\n      rows.forEach((row, rowIdx) => {\r\n        const cells = row.querySelectorAll('th, td');\r\n        const cellTexts = Array.from(cells).map(cell => cell.textContent?.trim() || '');\r\n        parts.push(`| ${cellTexts.join(' | ')} |`);\r\n\r\n        // Add separator after header row\r\n        if (rowIdx === 0 && row.querySelector('th')) {\r\n          parts.push(`| ${cellTexts.map(() => '---').join(' | ')} |`);\r\n        }\r\n      });\r\n    });\r\n\r\n    return parts.length > 0 ? parts.join('\\n') : null;\r\n  }\r\n\r\n  /**\r\n   * Extract form information\r\n   */\r\n  private extractForms(element: Element): string | null {\r\n    const inputs = element.querySelectorAll('input, select, textarea');\r\n    if (inputs.length === 0) return null;\r\n\r\n    const parts: string[] = [];\r\n\r\n    inputs.forEach(input => {\r\n      // Skip inputs inside chat widget\r\n      if (input.closest('#chat-widget-container')) return;\r\n\r\n      const el = input as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement;\r\n      const label = this.findLabelFor(el);\r\n      const type = el.tagName === 'INPUT' ? (el as HTMLInputElement).type : el.tagName.toLowerCase();\r\n      const name = el.name || el.id || 'unnamed';\r\n      const value = el.value || '';\r\n\r\n      // Don't include password values\r\n      if (type === 'password') {\r\n        parts.push(`- ${label || name} (${type}): [hidden]`);\r\n      } else if (type === 'hidden') {\r\n        // Skip hidden fields\r\n      } else if (el.tagName === 'SELECT') {\r\n        const select = el as HTMLSelectElement;\r\n        const selectedOption = select.options[select.selectedIndex];\r\n        parts.push(`- ${label || name} (select): ${selectedOption?.text || 'none'}`);\r\n      } else {\r\n        parts.push(`- ${label || name} (${type}): ${value || '[empty]'}`);\r\n      }\r\n    });\r\n\r\n    return parts.length > 0 ? parts.join('\\n') : null;\r\n  }\r\n\r\n  /**\r\n   * Find label text for a form element\r\n   */\r\n  private findLabelFor(element: HTMLElement): string | null {\r\n    // Check for associated label\r\n    const id = element.id;\r\n    if (id) {\r\n      const label = document.querySelector(`label[for=\"${id}\"]`);\r\n      if (label) {\r\n        return label.textContent?.trim() || null;\r\n      }\r\n    }\r\n\r\n    // Check for wrapping label\r\n    const parentLabel = element.closest('label');\r\n    if (parentLabel) {\r\n      const text = this.getDirectText(parentLabel);\r\n      if (text) return text;\r\n    }\r\n\r\n    // Check for aria-label\r\n    const ariaLabel = element.getAttribute('aria-label');\r\n    if (ariaLabel) return ariaLabel;\r\n\r\n    // Check placeholder\r\n    const placeholder = element.getAttribute('placeholder');\r\n    if (placeholder) return placeholder;\r\n\r\n    return null;\r\n  }\r\n}\r\n", "/**\r\n * Avatar button component - the floating chat trigger\r\n */\r\n\r\nimport type { AvatarOptions } from '../types';\r\nimport { prefersReducedMotion } from '../services/dom';\r\n\r\nconst DEFAULT_CHAT_ICON = `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\r\n</svg>\r\n`;\r\n\r\nconst CLOSE_ICON = `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n</svg>\r\n`;\r\n\r\nexport class AvatarComponent {\r\n  private element: HTMLButtonElement;\r\n  private options: AvatarOptions;\r\n  private _isOpen: boolean = false;\r\n  private badgeElement: HTMLSpanElement | null = null;\r\n\r\n  constructor(options: AvatarOptions) {\r\n    this.options = options;\r\n    this.element = this.render();\r\n  }\r\n\r\n  private render(): HTMLButtonElement {\r\n    const button = document.createElement('button');\r\n    button.className = 'chat-widget-avatar';\r\n    button.setAttribute('aria-label', 'Open chat');\r\n    button.setAttribute('aria-haspopup', 'dialog');\r\n    button.setAttribute('aria-expanded', 'false');\r\n    button.setAttribute('type', 'button');\r\n\r\n    // Apply positioning\r\n    button.classList.add(`chat-widget-avatar--${this.options.position}`);\r\n\r\n    // Apply size\r\n    button.style.width = `${this.options.size}px`;\r\n    button.style.height = `${this.options.size}px`;\r\n\r\n    // Apply primary color\r\n    button.style.setProperty('--chat-widget-primary', this.options.primaryColor);\r\n\r\n    // Set content (image or icon)\r\n    if (this.options.imageUrl) {\r\n      const img = document.createElement('img');\r\n      img.src = this.options.imageUrl;\r\n      img.alt = '';\r\n      img.setAttribute('aria-hidden', 'true');\r\n      img.className = 'chat-widget-avatar__image';\r\n      button.appendChild(img);\r\n    } else {\r\n      const iconWrapper = document.createElement('span');\r\n      iconWrapper.className = 'chat-widget-avatar__icon';\r\n      iconWrapper.innerHTML = DEFAULT_CHAT_ICON;\r\n      iconWrapper.setAttribute('aria-hidden', 'true');\r\n      button.appendChild(iconWrapper);\r\n    }\r\n\r\n    // Create unread badge\r\n    this.badgeElement = document.createElement('span');\r\n    this.badgeElement.className = 'chat-widget-avatar__badge';\r\n    this.badgeElement.setAttribute('aria-hidden', 'true');\r\n    this.badgeElement.style.display = 'none';\r\n    button.appendChild(this.badgeElement);\r\n\r\n    // Event handlers\r\n    button.addEventListener('click', (e) => {\r\n      e.preventDefault();\r\n      this.options.onClick();\r\n    });\r\n\r\n    // Keyboard support\r\n    button.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' || e.key === ' ') {\r\n        e.preventDefault();\r\n        this.options.onClick();\r\n      }\r\n    });\r\n\r\n    // Hover animation (unless reduced motion)\r\n    if (!prefersReducedMotion()) {\r\n      button.classList.add('chat-widget-avatar--animated');\r\n    }\r\n\r\n    return button;\r\n  }\r\n\r\n  /**\r\n   * Get the DOM element\r\n   */\r\n  getElement(): HTMLButtonElement {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Check if avatar shows open state\r\n   */\r\n  isOpenState(): boolean {\r\n    return this._isOpen;\r\n  }\r\n\r\n  /**\r\n   * Show the avatar button\r\n   */\r\n  show(): void {\r\n    this.element.style.display = 'flex';\r\n    this.element.setAttribute('aria-hidden', 'false');\r\n  }\r\n\r\n  /**\r\n   * Hide the avatar button\r\n   */\r\n  hide(): void {\r\n    this.element.style.display = 'none';\r\n    this.element.setAttribute('aria-hidden', 'true');\r\n  }\r\n\r\n  /**\r\n   * Set the open/closed state (changes icon)\r\n   */\r\n  setOpen(isOpen: boolean): void {\r\n    this._isOpen = isOpen;\r\n    this.element.setAttribute('aria-expanded', String(isOpen));\r\n\r\n    // Update icon if no custom image\r\n    if (!this.options.imageUrl) {\r\n      const iconWrapper = this.element.querySelector('.chat-widget-avatar__icon');\r\n      if (iconWrapper) {\r\n        iconWrapper.innerHTML = isOpen ? CLOSE_ICON : DEFAULT_CHAT_ICON;\r\n      }\r\n    }\r\n\r\n    // Update aria-label\r\n    this.element.setAttribute('aria-label', isOpen ? 'Close chat' : 'Open chat');\r\n  }\r\n\r\n  /**\r\n   * Enable pulse animation\r\n   */\r\n  setPulse(enabled: boolean): void {\r\n    if (enabled && !prefersReducedMotion()) {\r\n      this.element.classList.add('chat-widget-avatar--pulse');\r\n    } else {\r\n      this.element.classList.remove('chat-widget-avatar--pulse');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show unread indicator\r\n   */\r\n  showBadge(count?: number): void {\r\n    if (this.badgeElement) {\r\n      this.badgeElement.style.display = 'flex';\r\n      if (count !== undefined && count > 0) {\r\n        this.badgeElement.textContent = count > 9 ? '9+' : String(count);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide unread indicator\r\n   */\r\n  hideBadge(): void {\r\n    if (this.badgeElement) {\r\n      this.badgeElement.style.display = 'none';\r\n      this.badgeElement.textContent = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update options\r\n   */\r\n  updateOptions(options: Partial<AvatarOptions>): void {\r\n    if (options.primaryColor) {\r\n      this.options.primaryColor = options.primaryColor;\r\n      this.element.style.setProperty('--chat-widget-primary', options.primaryColor);\r\n    }\r\n\r\n    if (options.size) {\r\n      this.options.size = options.size;\r\n      this.element.style.width = `${options.size}px`;\r\n      this.element.style.height = `${options.size}px`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroy the component\r\n   */\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}\r\n", "/**\r\n * Panel component - the main chat panel with push content support\r\n */\r\n\r\nimport type { PanelOptions } from '../types';\r\nimport { escapeHtml, createFocusTrap, isMobile, prefersReducedMotion, scrollToBottom } from '../services/dom';\r\nimport { InputComponent } from './input';\r\n\r\nconst MINIMIZE_ICON = `\r\n<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <polyline points=\"4 14 10 14 10 20\"></polyline>\r\n  <polyline points=\"20 10 14 10 14 4\"></polyline>\r\n  <line x1=\"14\" y1=\"10\" x2=\"21\" y2=\"3\"></line>\r\n  <line x1=\"3\" y1=\"21\" x2=\"10\" y2=\"14\"></line>\r\n</svg>\r\n`;\r\n\r\nconst CLOSE_ICON = `\r\n<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n</svg>\r\n`;\r\n\r\nconst CLEAR_ICON = `\r\n<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <polyline points=\"3 6 5 6 21 6\"></polyline>\r\n  <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path>\r\n</svg>\r\n`;\r\n\r\nexport class PanelComponent {\r\n  private element: HTMLDivElement;\r\n  private messagesContainer: HTMLDivElement;\r\n  private inputContainer: HTMLDivElement;\r\n  private options: PanelOptions;\r\n  private isOpen: boolean = false;\r\n  private focusTrap: ReturnType<typeof createFocusTrap>;\r\n  private originalBodyStyle: {\r\n    marginLeft: string;\r\n    marginRight: string;\r\n    transition: string;\r\n  } | null = null;\r\n\r\n  constructor(options: PanelOptions) {\r\n    this.options = options;\r\n    this.element = this.render();\r\n    this.messagesContainer = this.element.querySelector('.chat-widget-messages') as HTMLDivElement;\r\n    this.inputContainer = this.element.querySelector('.chat-widget-panel__input') as HTMLDivElement;\r\n    this.focusTrap = createFocusTrap(this.element);\r\n\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  private render(): HTMLDivElement {\r\n    const panel = document.createElement('div');\r\n    panel.className = `chat-widget-panel chat-widget-panel--${this.options.position}`;\r\n    panel.setAttribute('role', 'dialog');\r\n    panel.setAttribute('aria-label', this.options.title);\r\n    panel.setAttribute('aria-modal', 'false');\r\n    panel.setAttribute('aria-hidden', 'true');\r\n\r\n    // Apply dimensions\r\n    panel.style.width = `${this.options.width}px`;\r\n    if (this.options.height !== 'full') {\r\n      panel.style.height = `${this.options.height}px`;\r\n    }\r\n\r\n    panel.innerHTML = `\r\n      <div class=\"chat-widget-panel__header\">\r\n        <div class=\"chat-widget-panel__title\">\r\n          <h2>${escapeHtml(this.options.title)}</h2>\r\n        </div>\r\n        <div class=\"chat-widget-panel__actions\">\r\n          <button\r\n            class=\"chat-widget-panel__btn chat-widget-panel__btn--clear\"\r\n            aria-label=\"Clear chat history\"\r\n            title=\"Clear History\"\r\n            type=\"button\"\r\n          >\r\n            ${CLEAR_ICON}\r\n          </button>\r\n          <button\r\n            class=\"chat-widget-panel__btn chat-widget-panel__btn--minimize\"\r\n            aria-label=\"Minimize chat\"\r\n            title=\"Minimize\"\r\n            type=\"button\"\r\n          >\r\n            ${MINIMIZE_ICON}\r\n          </button>\r\n          <button\r\n            class=\"chat-widget-panel__btn chat-widget-panel__btn--close\"\r\n            aria-label=\"Close chat\"\r\n            title=\"Close\"\r\n            type=\"button\"\r\n          >\r\n            ${CLOSE_ICON}\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div class=\"chat-widget-messages\" role=\"log\" aria-live=\"polite\" aria-atomic=\"false\">\r\n        <div class=\"chat-widget-messages__welcome\"></div>\r\n      </div>\r\n      <div class=\"chat-widget-panel__input\"></div>\r\n    `;\r\n\r\n    return panel;\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    // Close button\r\n    const closeBtn = this.element.querySelector('.chat-widget-panel__btn--close');\r\n    closeBtn?.addEventListener('click', () => this.options.onClose());\r\n\r\n    // Minimize button\r\n    const minimizeBtn = this.element.querySelector('.chat-widget-panel__btn--minimize');\r\n    minimizeBtn?.addEventListener('click', () => this.options.onMinimize());\r\n\r\n    // Clear history button\r\n    const clearBtn = this.element.querySelector('.chat-widget-panel__btn--clear');\r\n    clearBtn?.addEventListener('click', () => this.options.onClearHistory());\r\n\r\n    // Escape key to close\r\n    this.element.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        this.options.onClose();\r\n      }\r\n    });\r\n\r\n    // Handle window resize for mobile\r\n    window.addEventListener('resize', () => {\r\n      if (this.isOpen) {\r\n        this.updatePushContent();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the DOM element\r\n   */\r\n  getElement(): HTMLDivElement {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Get the messages container\r\n   */\r\n  getMessagesContainer(): HTMLDivElement {\r\n    return this.messagesContainer;\r\n  }\r\n\r\n  /**\r\n   * Get the input container for mounting InputComponent\r\n   */\r\n  getInputContainer(): HTMLDivElement {\r\n    return this.inputContainer;\r\n  }\r\n\r\n  /**\r\n   * Mount the input component\r\n   */\r\n  mountInput(input: InputComponent): void {\r\n    this.inputContainer.appendChild(input.getElement());\r\n  }\r\n\r\n  /**\r\n   * Open the panel\r\n   */\r\n  open(): void {\r\n    if (this.isOpen) return;\r\n\r\n    this.isOpen = true;\r\n    this.element.classList.add('chat-widget-panel--open');\r\n    this.element.setAttribute('aria-hidden', 'false');\r\n\r\n    // Apply push content if enabled\r\n    if (this.options.pushContent) {\r\n      this.applyPushContent(true);\r\n    }\r\n\r\n    // Activate focus trap after animation\r\n    const animationDuration = prefersReducedMotion() ? 0 : 300;\r\n    setTimeout(() => {\r\n      this.focusTrap.activate();\r\n    }, animationDuration);\r\n  }\r\n\r\n  /**\r\n   * Close the panel\r\n   */\r\n  close(): void {\r\n    if (!this.isOpen) return;\r\n\r\n    this.isOpen = false;\r\n    this.element.classList.remove('chat-widget-panel--open');\r\n    this.element.setAttribute('aria-hidden', 'true');\r\n\r\n    // Remove push content\r\n    if (this.options.pushContent) {\r\n      this.applyPushContent(false);\r\n    }\r\n\r\n    this.focusTrap.deactivate();\r\n  }\r\n\r\n  /**\r\n   * Check if panel is open\r\n   */\r\n  isOpened(): boolean {\r\n    return this.isOpen;\r\n  }\r\n\r\n  /**\r\n   * Apply or remove push content effect\r\n   */\r\n  private applyPushContent(push: boolean): void {\r\n    // On mobile, use full screen instead of push\r\n    if (isMobile()) {\r\n      return;\r\n    }\r\n\r\n    const isRight = this.options.position.includes('right');\r\n    const property = isRight ? 'marginRight' : 'marginLeft';\r\n\r\n    if (push) {\r\n      // Store original styles\r\n      this.originalBodyStyle = {\r\n        marginLeft: document.body.style.marginLeft,\r\n        marginRight: document.body.style.marginRight,\r\n        transition: document.body.style.transition,\r\n      };\r\n\r\n      // Apply transition and margin\r\n      if (!prefersReducedMotion()) {\r\n        document.body.style.transition = 'margin 0.3s ease-in-out';\r\n      }\r\n      document.body.style[property] = `${this.options.width}px`;\r\n    } else {\r\n      // Restore original styles\r\n      if (!prefersReducedMotion()) {\r\n        document.body.style.transition = 'margin 0.3s ease-in-out';\r\n      }\r\n      document.body.style[property] = this.originalBodyStyle?.[property] || '';\r\n\r\n      // Clean up transition after animation\r\n      setTimeout(() => {\r\n        if (this.originalBodyStyle) {\r\n          document.body.style.transition = this.originalBodyStyle.transition;\r\n        }\r\n      }, 300);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update push content on resize\r\n   */\r\n  private updatePushContent(): void {\r\n    if (!this.options.pushContent) return;\r\n\r\n    // On mobile, remove push content\r\n    if (isMobile()) {\r\n      if (this.originalBodyStyle) {\r\n        document.body.style.marginLeft = this.originalBodyStyle.marginLeft;\r\n        document.body.style.marginRight = this.originalBodyStyle.marginRight;\r\n      }\r\n    } else {\r\n      // Re-apply push content\r\n      this.applyPushContent(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a message element to the container\r\n   */\r\n  addMessage(messageElement: HTMLElement): void {\r\n    // Remove welcome message if present\r\n    const welcome = this.messagesContainer.querySelector('.chat-widget-messages__welcome');\r\n    if (welcome && welcome.children.length === 0) {\r\n      welcome.remove();\r\n    }\r\n\r\n    this.messagesContainer.appendChild(messageElement);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Set the welcome message\r\n   */\r\n  setWelcomeMessage(message: string): void {\r\n    const welcome = this.messagesContainer.querySelector('.chat-widget-messages__welcome');\r\n    if (welcome) {\r\n      welcome.innerHTML = `\r\n        <div class=\"chat-widget-welcome\">\r\n          <p>${escapeHtml(message)}</p>\r\n        </div>\r\n      `;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all messages\r\n   */\r\n  clearMessages(): void {\r\n    this.messagesContainer.innerHTML = '<div class=\"chat-widget-messages__welcome\"></div>';\r\n  }\r\n\r\n  /**\r\n   * Scroll messages to bottom\r\n   */\r\n  scrollToBottom(): void {\r\n    scrollToBottom(this.messagesContainer);\r\n  }\r\n\r\n  /**\r\n   * Update panel title\r\n   */\r\n  setTitle(title: string): void {\r\n    const titleElement = this.element.querySelector('.chat-widget-panel__title h2');\r\n    if (titleElement) {\r\n      titleElement.textContent = title;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show loading state\r\n   */\r\n  showLoading(): void {\r\n    this.element.classList.add('chat-widget-panel--loading');\r\n  }\r\n\r\n  /**\r\n   * Hide loading state\r\n   */\r\n  hideLoading(): void {\r\n    this.element.classList.remove('chat-widget-panel--loading');\r\n  }\r\n\r\n  /**\r\n   * Show error state\r\n   */\r\n  showError(message: string): void {\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'chat-widget-panel__error';\r\n    errorDiv.innerHTML = `\r\n      <p>${escapeHtml(message)}</p>\r\n      <button type=\"button\" class=\"chat-widget-panel__error-dismiss\">Dismiss</button>\r\n    `;\r\n\r\n    errorDiv.querySelector('button')?.addEventListener('click', () => {\r\n      errorDiv.remove();\r\n    });\r\n\r\n    this.element.insertBefore(errorDiv, this.messagesContainer);\r\n  }\r\n\r\n  /**\r\n   * Update options\r\n   */\r\n  updateOptions(options: Partial<PanelOptions>): void {\r\n    if (options.width !== undefined) {\r\n      this.options.width = options.width;\r\n      this.element.style.width = `${options.width}px`;\r\n\r\n      // Update push content if open\r\n      if (this.isOpen && this.options.pushContent) {\r\n        this.applyPushContent(true);\r\n      }\r\n    }\r\n\r\n    if (options.height !== undefined) {\r\n      this.options.height = options.height;\r\n      if (options.height !== 'full') {\r\n        this.element.style.height = `${options.height}px`;\r\n      } else {\r\n        this.element.style.height = '';\r\n      }\r\n    }\r\n\r\n    if (options.title !== undefined) {\r\n      this.setTitle(options.title);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroy the component\r\n   */\r\n  destroy(): void {\r\n    if (this.isOpen) {\r\n      this.close();\r\n    }\r\n    this.element.remove();\r\n  }\r\n}\r\n", "/**\r\n * Message component - renders individual chat messages\r\n */\r\n\r\nimport type { Message, ToolCall } from '../types';\r\nimport { MarkdownService, initCodeCopyButtons } from '../services/markdown';\r\nimport { setTextDirection, escapeHtml } from '../services/dom';\r\n\r\nexport class MessageComponent {\r\n  private element: HTMLDivElement;\r\n  private contentElement: HTMLDivElement;\r\n  private message: Message;\r\n  private markdownService: MarkdownService;\r\n\r\n  constructor(message: Message, markdownService: MarkdownService) {\r\n    this.message = message;\r\n    this.markdownService = markdownService;\r\n    this.element = this.render();\r\n    this.contentElement = this.element.querySelector('.chat-widget-message__content') as HTMLDivElement;\r\n  }\r\n\r\n  private render(): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.className = `chat-widget-message chat-widget-message--${this.message.role}`;\r\n    div.setAttribute('data-message-id', this.message.id);\r\n    div.setAttribute('data-status', this.message.status);\r\n\r\n    // Set text direction based on content\r\n    if (this.message.content) {\r\n      setTextDirection(div, this.message.content);\r\n    }\r\n\r\n    const isAssistant = this.message.role === 'assistant';\r\n\r\n    div.innerHTML = `\r\n      ${isAssistant ? '<div class=\"chat-widget-message__avatar\" aria-hidden=\"true\"></div>' : ''}\r\n      <div class=\"chat-widget-message__body\">\r\n        <div class=\"chat-widget-message__content\"></div>\r\n        <div class=\"chat-widget-message__meta\">\r\n          <time datetime=\"${new Date(this.message.timestamp).toISOString()}\">\r\n            ${this.formatTime(this.message.timestamp)}\r\n          </time>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Render content\r\n    const contentDiv = div.querySelector('.chat-widget-message__content') as HTMLDivElement;\r\n    this.renderContent(contentDiv);\r\n\r\n    // Render tool calls if present (skip hidden internal tools)\r\n    if (this.message.toolCalls && this.message.toolCalls.length > 0) {\r\n      const toolsContainer = document.createElement('div');\r\n      toolsContainer.className = 'chat-widget-message__tools';\r\n      let hasVisibleTools = false;\r\n      this.message.toolCalls.forEach((tool) => {\r\n        const toolElement = this.renderToolCall(tool);\r\n        if (toolElement) {\r\n          toolsContainer.appendChild(toolElement);\r\n          hasVisibleTools = true;\r\n        }\r\n      });\r\n      if (hasVisibleTools) {\r\n        div.querySelector('.chat-widget-message__body')?.appendChild(toolsContainer);\r\n      }\r\n    }\r\n\r\n    // Add streaming indicator if streaming\r\n    if (this.message.status === 'streaming') {\r\n      div.classList.add('chat-widget-message--streaming');\r\n    }\r\n\r\n    return div;\r\n  }\r\n\r\n  private renderContent(container: HTMLDivElement): void {\r\n    const isStreaming = this.message.status === 'streaming';\r\n\r\n    if (this.message.role === 'user') {\r\n      // User messages are plain text\r\n      container.innerHTML = this.markdownService.renderUserMessage(this.message.content);\r\n    } else {\r\n      // Assistant messages get markdown rendering\r\n      container.innerHTML = this.markdownService.renderProgressive(\r\n        this.message.content,\r\n        !isStreaming\r\n      );\r\n\r\n      // Initialize copy buttons for code blocks\r\n      initCodeCopyButtons(container);\r\n    }\r\n  }\r\n\r\n  // Internal tools that should be hidden from the user\r\n  private static readonly HIDDEN_TOOLS = ['getPageContent'];\r\n\r\n  private renderToolCall(toolCall: ToolCall): HTMLElement | null {\r\n    // Hide internal system tools\r\n    if (MessageComponent.HIDDEN_TOOLS.includes(toolCall.toolName)) {\r\n      return null;\r\n    }\r\n\r\n    const div = document.createElement('div');\r\n    div.className = `chat-widget-tool chat-widget-tool--${toolCall.status}`;\r\n    div.setAttribute('data-tool-id', toolCall.id);\r\n\r\n    const statusIcon = this.getToolStatusIcon(toolCall.status);\r\n\r\n    div.innerHTML = `\r\n      <div class=\"chat-widget-tool__header\">\r\n        <span class=\"chat-widget-tool__icon\">${statusIcon}</span>\r\n        <span class=\"chat-widget-tool__name\">${escapeHtml(toolCall.toolName)}</span>\r\n        <span class=\"chat-widget-tool__status\">${toolCall.status}</span>\r\n      </div>\r\n    `;\r\n\r\n    return div;\r\n  }\r\n\r\n  private getToolStatusIcon(status: string): string {\r\n    switch (status) {\r\n      case 'pending':\r\n        return `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"chat-widget-tool__spinner\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n          <path d=\"M12 6v6l4 2\"></path>\r\n        </svg>`;\r\n      case 'complete':\r\n        return `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <polyline points=\"20 6 9 17 4 12\"></polyline>\r\n        </svg>`;\r\n      case 'error':\r\n        return `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n          <line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"></line>\r\n          <line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"></line>\r\n        </svg>`;\r\n      default:\r\n        return '';\r\n    }\r\n  }\r\n\r\n  private formatTime(timestamp: number): string {\r\n    return new Date(timestamp).toLocaleTimeString(undefined, {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the DOM element\r\n   */\r\n  getElement(): HTMLDivElement {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Get the message data\r\n   */\r\n  getMessage(): Message {\r\n    return this.message;\r\n  }\r\n\r\n  /**\r\n   * Update message content\r\n   */\r\n  updateContent(content: string, isComplete: boolean = false): void {\r\n    this.message.content = content;\r\n\r\n    // Update text direction\r\n    setTextDirection(this.element, content);\r\n\r\n    // Re-render content\r\n    if (this.message.role === 'user') {\r\n      this.contentElement.innerHTML = this.markdownService.renderUserMessage(content);\r\n    } else {\r\n      this.contentElement.innerHTML = this.markdownService.renderProgressive(content, isComplete);\r\n      initCodeCopyButtons(this.contentElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set message status\r\n   */\r\n  setStatus(status: Message['status']): void {\r\n    this.message.status = status;\r\n    this.element.setAttribute('data-status', status);\r\n\r\n    if (status === 'streaming') {\r\n      this.element.classList.add('chat-widget-message--streaming');\r\n    } else {\r\n      this.element.classList.remove('chat-widget-message--streaming');\r\n    }\r\n\r\n    if (status === 'error') {\r\n      this.element.classList.add('chat-widget-message--error');\r\n    } else {\r\n      this.element.classList.remove('chat-widget-message--error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a tool call to the message\r\n   */\r\n  addToolCall(toolCall: ToolCall): void {\r\n    if (!this.message.toolCalls) {\r\n      this.message.toolCalls = [];\r\n    }\r\n    this.message.toolCalls.push(toolCall);\r\n\r\n    let toolsContainer = this.element.querySelector('.chat-widget-message__tools');\r\n    if (!toolsContainer) {\r\n      toolsContainer = document.createElement('div');\r\n      toolsContainer.className = 'chat-widget-message__tools';\r\n      this.element.querySelector('.chat-widget-message__body')?.appendChild(toolsContainer);\r\n    }\r\n\r\n    const toolElement = this.renderToolCall(toolCall);\r\n    if (toolElement) {\r\n      toolsContainer.appendChild(toolElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a tool call status\r\n   */\r\n  updateToolCall(toolCallId: string, updates: Partial<ToolCall>): void {\r\n    const toolCall = this.message.toolCalls?.find((t) => t.id === toolCallId);\r\n    if (toolCall) {\r\n      Object.assign(toolCall, updates);\r\n\r\n      // Update DOM\r\n      const toolElement = this.element.querySelector(`[data-tool-id=\"${toolCallId}\"]`);\r\n      if (toolElement && updates.status) {\r\n        toolElement.className = `chat-widget-tool chat-widget-tool--${updates.status}`;\r\n\r\n        const statusSpan = toolElement.querySelector('.chat-widget-tool__status');\r\n        if (statusSpan) {\r\n          statusSpan.textContent = updates.status;\r\n        }\r\n\r\n        const iconSpan = toolElement.querySelector('.chat-widget-tool__icon');\r\n        if (iconSpan) {\r\n          iconSpan.innerHTML = this.getToolStatusIcon(updates.status);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error state\r\n   */\r\n  showError(errorMessage: string): void {\r\n    this.setStatus('error');\r\n\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'chat-widget-message__error';\r\n    errorDiv.innerHTML = `\r\n      <span class=\"chat-widget-message__error-icon\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n          <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>\r\n          <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>\r\n        </svg>\r\n      </span>\r\n      <span class=\"chat-widget-message__error-text\">${escapeHtml(errorMessage)}</span>\r\n    `;\r\n\r\n    this.element.querySelector('.chat-widget-message__body')?.appendChild(errorDiv);\r\n  }\r\n\r\n  /**\r\n   * Scroll the message into view\r\n   */\r\n  scrollIntoView(): void {\r\n    this.element.scrollIntoView({ behavior: 'smooth', block: 'end' });\r\n  }\r\n\r\n  /**\r\n   * Destroy the component\r\n   */\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}\r\n", "/**\r\n * Input component - text input area with send button and typing indicator\r\n */\r\n\r\nimport type { InputOptions } from '../types';\r\n\r\nconst SEND_ICON = `\r\n<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n  <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\r\n  <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\r\n</svg>\r\n`;\r\n\r\nexport class InputComponent {\r\n  private element: HTMLFormElement;\r\n  private textarea: HTMLTextAreaElement;\r\n  private sendButton: HTMLButtonElement;\r\n  private typingIndicator: HTMLDivElement;\r\n  private options: InputOptions;\r\n  private isDisabled: boolean = false;\r\n\r\n  constructor(options: InputOptions) {\r\n    this.options = options;\r\n    this.element = this.render();\r\n    this.textarea = this.element.querySelector('.chat-widget-input__field') as HTMLTextAreaElement;\r\n    this.sendButton = this.element.querySelector('.chat-widget-input__send') as HTMLButtonElement;\r\n    this.typingIndicator = this.element.querySelector('.chat-widget-typing') as HTMLDivElement;\r\n\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  private render(): HTMLFormElement {\r\n    const form = document.createElement('form');\r\n    form.className = 'chat-widget-input';\r\n    form.setAttribute('autocomplete', 'off');\r\n\r\n    form.innerHTML = `\r\n      <div class=\"chat-widget-typing\" aria-live=\"polite\" aria-hidden=\"true\">\r\n        <span class=\"chat-widget-typing__dot\"></span>\r\n        <span class=\"chat-widget-typing__dot\"></span>\r\n        <span class=\"chat-widget-typing__dot\"></span>\r\n        <span class=\"chat-widget-typing__text\">AI is thinking...</span>\r\n      </div>\r\n      <div class=\"chat-widget-input__row\">\r\n        <textarea\r\n          class=\"chat-widget-input__field\"\r\n          placeholder=\"${this.escapeAttr(this.options.placeholder)}\"\r\n          rows=\"1\"\r\n          aria-label=\"${this.escapeAttr(this.options.placeholder)}\"\r\n        ></textarea>\r\n        <button\r\n          type=\"submit\"\r\n          class=\"chat-widget-input__send\"\r\n          aria-label=\"Send message\"\r\n          title=\"Send message\"\r\n        >\r\n          ${SEND_ICON}\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    return form;\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    // Form submission\r\n    this.element.addEventListener('submit', (e) => {\r\n      e.preventDefault();\r\n      this.handleSubmit();\r\n    });\r\n\r\n    // Auto-resize textarea\r\n    this.textarea.addEventListener('input', () => {\r\n      this.autoResize();\r\n      this.updateSendButtonState();\r\n    });\r\n\r\n    // Enter to send (Shift+Enter for new line)\r\n    this.textarea.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        this.handleSubmit();\r\n      }\r\n    });\r\n\r\n    // Paste handling\r\n    this.textarea.addEventListener('paste', () => {\r\n      // Delay to get the pasted content\r\n      setTimeout(() => {\r\n        this.autoResize();\r\n        this.updateSendButtonState();\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  private handleSubmit(): void {\r\n    const message = this.textarea.value.trim();\r\n\r\n    if (message && !this.isDisabled) {\r\n      this.options.onSend(message);\r\n      this.clear();\r\n    }\r\n  }\r\n\r\n  private autoResize(): void {\r\n    // Reset height to calculate new height\r\n    this.textarea.style.height = 'auto';\r\n\r\n    // Calculate new height (max 120px)\r\n    const maxHeight = 120;\r\n    const newHeight = Math.min(this.textarea.scrollHeight, maxHeight);\r\n    this.textarea.style.height = `${newHeight}px`;\r\n\r\n    // Toggle scroll if at max height\r\n    this.textarea.style.overflowY = this.textarea.scrollHeight > maxHeight ? 'auto' : 'hidden';\r\n  }\r\n\r\n  private updateSendButtonState(): void {\r\n    const hasContent = this.textarea.value.trim().length > 0;\r\n    this.sendButton.disabled = !hasContent || this.isDisabled;\r\n  }\r\n\r\n  private escapeAttr(str: string): string {\r\n    return str.replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\r\n  }\r\n\r\n  /**\r\n   * Get the DOM element\r\n   */\r\n  getElement(): HTMLFormElement {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Focus the input field\r\n   */\r\n  focus(): void {\r\n    this.textarea.focus();\r\n  }\r\n\r\n  /**\r\n   * Clear the input field\r\n   */\r\n  clear(): void {\r\n    this.textarea.value = '';\r\n    this.textarea.style.height = 'auto';\r\n    this.updateSendButtonState();\r\n  }\r\n\r\n  /**\r\n   * Set the input value\r\n   */\r\n  setValue(value: string): void {\r\n    this.textarea.value = value;\r\n    this.autoResize();\r\n    this.updateSendButtonState();\r\n  }\r\n\r\n  /**\r\n   * Get the current input value\r\n   */\r\n  getValue(): string {\r\n    return this.textarea.value;\r\n  }\r\n\r\n  /**\r\n   * Disable the input\r\n   */\r\n  disable(): void {\r\n    this.isDisabled = true;\r\n    this.textarea.disabled = true;\r\n    this.sendButton.disabled = true;\r\n    this.element.classList.add('chat-widget-input--disabled');\r\n  }\r\n\r\n  /**\r\n   * Enable the input\r\n   */\r\n  enable(): void {\r\n    this.isDisabled = false;\r\n    this.textarea.disabled = false;\r\n    this.updateSendButtonState();\r\n    this.element.classList.remove('chat-widget-input--disabled');\r\n  }\r\n\r\n  /**\r\n   * Show typing indicator\r\n   */\r\n  showTyping(): void {\r\n    this.typingIndicator.classList.add('chat-widget-typing--visible');\r\n    this.typingIndicator.setAttribute('aria-hidden', 'false');\r\n  }\r\n\r\n  /**\r\n   * Hide typing indicator\r\n   */\r\n  hideTyping(): void {\r\n    this.typingIndicator.classList.remove('chat-widget-typing--visible');\r\n    this.typingIndicator.setAttribute('aria-hidden', 'true');\r\n  }\r\n\r\n  /**\r\n   * Check if input is disabled\r\n   */\r\n  isInputDisabled(): boolean {\r\n    return this.isDisabled;\r\n  }\r\n\r\n  /**\r\n   * Update placeholder text\r\n   */\r\n  setPlaceholder(placeholder: string): void {\r\n    this.textarea.placeholder = placeholder;\r\n    this.textarea.setAttribute('aria-label', placeholder);\r\n  }\r\n\r\n  /**\r\n   * Destroy the component\r\n   */\r\n  destroy(): void {\r\n    this.element.remove();\r\n  }\r\n}\r\n", "/**\n * CSS styles and variables for the chat widget\n */\n\nimport type { ChatWidgetConfig } from '../types';\n\n/**\n * Generate CSS custom properties from config\n */\nexport function generateCSSVariables(config: ChatWidgetConfig): string {\n  return `\n    --chat-widget-primary: ${config.primaryColor};\n    --chat-widget-bg: #ffffff;\n    --chat-widget-text: #1a1a1a;\n    --chat-widget-text-secondary: #6b7280;\n    --chat-widget-user-bubble: ${config.primaryColor};\n    --chat-widget-user-text: #ffffff;\n    --chat-widget-agent-bubble: #f3f4f6;\n    --chat-widget-agent-text: #1a1a1a;\n    --chat-widget-border: #e5e7eb;\n    --chat-widget-shadow: rgba(0, 0, 0, 0.15);\n    --chat-widget-code-bg: #1e293b;\n    --chat-widget-code-text: #e2e8f0;\n    --chat-widget-radius: 12px;\n    --chat-widget-avatar-size: ${config.avatarSize}px;\n    --chat-widget-panel-width: ${config.chatWidth}px;\n  `;\n}\n\n/**\n * Base CSS styles for the widget\n *\n * These styles are injected into the Shadow DOM for complete\n * CSS isolation from the host page.\n */\nexport const baseStyles = `\n  /* ============================================\n     Shadow DOM Reset and Container\n     ============================================\n     All styles are scoped to .chat-widget-root which lives\n     inside the Shadow DOM boundary. This provides complete\n     isolation from host page CSS.\n     ============================================ */\n\n  /* Apply to all elements within shadow DOM */\n  :host {\n    all: initial;\n  }\n\n  *,\n  *::before,\n  *::after {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n  }\n\n  .chat-widget-root {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,\n                 'Noto Sans', 'Helvetica Neue', Arial, sans-serif,\n                 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji';\n    font-size: 14px;\n    line-height: 1.5;\n    color: var(--chat-widget-text, #1a1a1a);\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n\n  .chat-widget-root > * {\n    pointer-events: auto;\n  }\n\n  /* Screen reader only */\n  .chat-widget-sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n  }\n\n  /* ============================================\n     Avatar Button\n     ============================================ */\n  .chat-widget-avatar {\n    position: fixed;\n    width: var(--chat-widget-avatar-size, 60px);\n    height: var(--chat-widget-avatar-size, 60px);\n    border-radius: 50%;\n    border: none;\n    background: var(--chat-widget-primary, #0066cc);\n    color: white;\n    cursor: pointer;\n    box-shadow: 0 4px 20px var(--chat-widget-shadow);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 99998;\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n  }\n\n  .chat-widget-avatar--bottom-right {\n    bottom: 20px;\n    right: 20px;\n  }\n\n  .chat-widget-avatar--bottom-left {\n    bottom: 20px;\n    left: 20px;\n  }\n\n  .chat-widget-avatar:hover {\n    transform: scale(1.05);\n    box-shadow: 0 6px 25px var(--chat-widget-shadow);\n  }\n\n  .chat-widget-avatar:focus {\n    outline: 2px solid var(--chat-widget-primary);\n    outline-offset: 3px;\n  }\n\n  .chat-widget-avatar:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  .chat-widget-avatar--animated.chat-widget-avatar--pulse {\n    animation: chat-widget-pulse 2s infinite;\n  }\n\n  @keyframes chat-widget-pulse {\n    0%, 100% {\n      box-shadow: 0 4px 20px var(--chat-widget-shadow);\n    }\n    50% {\n      box-shadow: 0 4px 30px var(--chat-widget-primary);\n    }\n  }\n\n  .chat-widget-avatar__image {\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    object-fit: cover;\n  }\n\n  .chat-widget-avatar__icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .chat-widget-avatar__badge {\n    position: absolute;\n    top: -4px;\n    right: -4px;\n    min-width: 20px;\n    height: 20px;\n    padding: 0 6px;\n    background: #ef4444;\n    color: white;\n    border-radius: 10px;\n    font-size: 11px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  /* ============================================\n     Panel\n     ============================================ */\n  .chat-widget-panel {\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    width: var(--chat-widget-panel-width, 400px);\n    max-width: 100vw;\n    background: var(--chat-widget-bg);\n    display: flex;\n    flex-direction: column;\n    box-shadow: -4px 0 30px var(--chat-widget-shadow);\n    z-index: 99999;\n    transform: translateX(100%);\n    transition: transform 0.3s ease-in-out;\n  }\n\n  .chat-widget-panel--bottom-right {\n    right: 0;\n    transform: translateX(100%);\n    box-shadow: -4px 0 30px var(--chat-widget-shadow);\n  }\n\n  .chat-widget-panel--bottom-left {\n    left: 0;\n    transform: translateX(-100%);\n    box-shadow: 4px 0 30px var(--chat-widget-shadow);\n  }\n\n  .chat-widget-panel--open {\n    transform: translateX(0);\n  }\n\n  @media (prefers-reduced-motion: reduce) {\n    .chat-widget-panel {\n      transition: none;\n    }\n    .chat-widget-avatar--animated.chat-widget-avatar--pulse {\n      animation: none;\n    }\n  }\n\n  /* Mobile: full screen */\n  @media (max-width: 768px) {\n    .chat-widget-panel {\n      width: 100%;\n      max-width: 100%;\n    }\n  }\n\n  /* ============================================\n     Panel Header\n     ============================================ */\n  .chat-widget-panel__header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    background: var(--chat-widget-primary);\n    color: white;\n    flex-shrink: 0;\n  }\n\n  .chat-widget-panel__title h2 {\n    font-size: 18px;\n    font-weight: 600;\n    margin: 0;\n  }\n\n  .chat-widget-panel__actions {\n    display: flex;\n    gap: 8px;\n  }\n\n  .chat-widget-panel__btn {\n    background: transparent;\n    border: none;\n    color: white;\n    width: 36px;\n    height: 36px;\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: background 0.2s ease;\n  }\n\n  .chat-widget-panel__btn:hover {\n    background: rgba(255, 255, 255, 0.2);\n  }\n\n  .chat-widget-panel__btn:focus {\n    outline: 2px solid white;\n    outline-offset: 2px;\n  }\n\n  .chat-widget-panel__btn:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  /* ============================================\n     Messages Area\n     ============================================ */\n  .chat-widget-messages {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n  }\n\n  .chat-widget-welcome {\n    text-align: center;\n    padding: 24px 16px;\n    color: var(--chat-widget-text-secondary);\n  }\n\n  .chat-widget-welcome p {\n    font-size: 15px;\n    line-height: 1.5;\n  }\n\n  /* ============================================\n     Message\n     ============================================ */\n  .chat-widget-message {\n    display: flex;\n    gap: 12px;\n    max-width: 85%;\n    animation: chat-widget-message-in 0.2s ease-out;\n  }\n\n  @keyframes chat-widget-message-in {\n    from {\n      opacity: 0;\n      transform: translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  @media (prefers-reduced-motion: reduce) {\n    .chat-widget-message {\n      animation: none;\n    }\n  }\n\n  .chat-widget-message--user {\n    align-self: flex-end;\n    flex-direction: row-reverse;\n  }\n\n  .chat-widget-message--assistant {\n    align-self: flex-start;\n  }\n\n  .chat-widget-message__avatar {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background: var(--chat-widget-primary);\n    flex-shrink: 0;\n  }\n\n  .chat-widget-message__body {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    min-width: 0;\n  }\n\n  .chat-widget-message__content {\n    padding: 12px 16px;\n    border-radius: var(--chat-widget-radius);\n    line-height: 1.5;\n    font-size: 15px;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n  }\n\n  .chat-widget-message--user .chat-widget-message__content {\n    background: var(--chat-widget-user-bubble);\n    color: var(--chat-widget-user-text);\n    border-bottom-right-radius: 4px;\n  }\n\n  .chat-widget-message--assistant .chat-widget-message__content {\n    background: var(--chat-widget-agent-bubble);\n    color: var(--chat-widget-agent-text);\n    border-bottom-left-radius: 4px;\n  }\n\n  .chat-widget-message__meta {\n    font-size: 11px;\n    color: var(--chat-widget-text-secondary);\n    padding: 0 4px;\n  }\n\n  /* Streaming cursor */\n  .chat-widget-message--streaming .chat-widget-message__content::after {\n    content: '';\n    display: inline-block;\n    width: 8px;\n    height: 16px;\n    background: var(--chat-widget-primary);\n    animation: chat-widget-blink 1s infinite;\n    margin-left: 4px;\n    vertical-align: middle;\n  }\n\n  @keyframes chat-widget-blink {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0; }\n  }\n\n  /* Error state */\n  .chat-widget-message--error .chat-widget-message__content {\n    background: #fef2f2;\n    color: #991b1b;\n  }\n\n  .chat-widget-message__error {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 12px;\n    background: #fef2f2;\n    border-radius: 8px;\n    color: #991b1b;\n    font-size: 13px;\n    margin-top: 8px;\n  }\n\n  /* ============================================\n     Tool Calls\n     ============================================ */\n  .chat-widget-message__tools {\n    margin-top: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n  }\n\n  .chat-widget-tool {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 12px;\n    background: #fef3c7;\n    border-radius: 8px;\n    font-size: 13px;\n  }\n\n  .chat-widget-tool--complete {\n    background: #d1fae5;\n  }\n\n  .chat-widget-tool--error {\n    background: #fee2e2;\n  }\n\n  .chat-widget-tool__header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n\n  .chat-widget-tool__name {\n    font-weight: 500;\n  }\n\n  .chat-widget-tool__status {\n    font-size: 11px;\n    color: var(--chat-widget-text-secondary);\n    text-transform: capitalize;\n  }\n\n  .chat-widget-tool__spinner {\n    animation: chat-widget-spin 1s linear infinite;\n  }\n\n  @keyframes chat-widget-spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n\n  /* ============================================\n     Input Area\n     ============================================ */\n  .chat-widget-input {\n    padding: 16px 20px;\n    border-top: 1px solid var(--chat-widget-border);\n    background: var(--chat-widget-bg);\n    flex-shrink: 0;\n  }\n\n  .chat-widget-input__row {\n    display: flex;\n    gap: 12px;\n    align-items: flex-end;\n  }\n\n  .chat-widget-input__field {\n    flex: 1;\n    border: 1px solid var(--chat-widget-border);\n    border-radius: 12px;\n    padding: 12px 16px;\n    font-size: 15px;\n    resize: none;\n    line-height: 1.4;\n    max-height: 120px;\n    overflow-y: hidden;\n    font-family: inherit;\n    background: var(--chat-widget-bg);\n    color: var(--chat-widget-text);\n  }\n\n  .chat-widget-input__field:focus {\n    outline: none;\n    border-color: var(--chat-widget-primary);\n    box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);\n  }\n\n  .chat-widget-input__field::placeholder {\n    color: var(--chat-widget-text-secondary);\n  }\n\n  .chat-widget-input__send {\n    width: 44px;\n    height: 44px;\n    min-width: 44px;\n    border: none;\n    border-radius: 50%;\n    background: var(--chat-widget-primary);\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: background 0.2s ease, opacity 0.2s ease;\n    flex-shrink: 0;\n  }\n\n  .chat-widget-input__send:hover:not(:disabled) {\n    filter: brightness(0.9);\n  }\n\n  .chat-widget-input__send:focus {\n    outline: 2px solid var(--chat-widget-primary);\n    outline-offset: 2px;\n  }\n\n  .chat-widget-input__send:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  .chat-widget-input__send:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .chat-widget-input--disabled .chat-widget-input__field {\n    background: #f9fafb;\n    cursor: not-allowed;\n  }\n\n  /* ============================================\n     Typing Indicator\n     ============================================ */\n  .chat-widget-typing {\n    display: none;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 12px;\n    color: var(--chat-widget-text-secondary);\n    font-size: 13px;\n  }\n\n  .chat-widget-typing--visible {\n    display: flex;\n  }\n\n  .chat-widget-typing__dot {\n    width: 6px;\n    height: 6px;\n    background: var(--chat-widget-primary);\n    border-radius: 50%;\n    animation: chat-widget-bounce 1.4s infinite ease-in-out;\n  }\n\n  .chat-widget-typing__dot:nth-child(1) { animation-delay: 0s; }\n  .chat-widget-typing__dot:nth-child(2) { animation-delay: 0.2s; }\n  .chat-widget-typing__dot:nth-child(3) { animation-delay: 0.4s; }\n\n  @keyframes chat-widget-bounce {\n    0%, 80%, 100% { transform: translateY(0); }\n    40% { transform: translateY(-6px); }\n  }\n\n  /* ============================================\n     Markdown Styles\n     ============================================\n     Markdown renders inline within the message bubble.\n     No card or container styling - just formatted text.\n     ============================================ */\n  .chat-widget-markdown {\n    line-height: 1.6;\n  }\n\n  .chat-widget-markdown > :first-child {\n    margin-top: 0;\n  }\n\n  .chat-widget-markdown > :last-child {\n    margin-bottom: 0;\n  }\n\n  .chat-widget-markdown p {\n    margin: 0 0 8px;\n  }\n\n  .chat-widget-markdown p:last-child {\n    margin-bottom: 0;\n  }\n\n  .chat-widget-markdown h1,\n  .chat-widget-markdown h2,\n  .chat-widget-markdown h3,\n  .chat-widget-markdown h4,\n  .chat-widget-markdown h5,\n  .chat-widget-markdown h6 {\n    margin: 16px 0 8px;\n    font-weight: 600;\n    line-height: 1.3;\n  }\n\n  .chat-widget-markdown h1 { font-size: 1.5em; }\n  .chat-widget-markdown h2 { font-size: 1.3em; }\n  .chat-widget-markdown h3 { font-size: 1.15em; }\n  .chat-widget-markdown h4,\n  .chat-widget-markdown h5,\n  .chat-widget-markdown h6 { font-size: 1em; }\n\n  .chat-widget-markdown ul,\n  .chat-widget-markdown ol {\n    margin: 8px 0;\n    padding-left: 24px;\n  }\n\n  .chat-widget-markdown li {\n    margin: 4px 0;\n  }\n\n  .chat-widget-markdown blockquote {\n    margin: 12px 0;\n    padding: 8px 16px;\n    border-left: 4px solid var(--chat-widget-primary);\n    background: rgba(0, 0, 0, 0.03);\n    border-radius: 0 8px 8px 0;\n  }\n\n  .chat-widget-markdown hr {\n    border: none;\n    border-top: 1px solid var(--chat-widget-border);\n    margin: 16px 0;\n  }\n\n  .chat-widget-markdown a {\n    color: var(--chat-widget-primary);\n    text-decoration: underline;\n  }\n\n  .chat-widget-markdown a:hover {\n    text-decoration: none;\n  }\n\n  .chat-widget-markdown table {\n    border-collapse: collapse;\n    width: 100%;\n    margin: 12px 0;\n    font-size: 14px;\n  }\n\n  .chat-widget-markdown th,\n  .chat-widget-markdown td {\n    border: 1px solid var(--chat-widget-border);\n    padding: 8px 12px;\n    text-align: left;\n  }\n\n  .chat-widget-markdown th {\n    background: rgba(0, 0, 0, 0.03);\n    font-weight: 600;\n  }\n\n  .chat-widget-markdown img {\n    max-width: 100%;\n    height: auto;\n    border-radius: 8px;\n    margin: 8px 0;\n  }\n\n  /* Inline code */\n  .chat-widget-inline-code {\n    background: rgba(0, 0, 0, 0.06);\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;\n    font-size: 0.9em;\n  }\n\n  /* Code blocks */\n  .chat-widget-code-block {\n    margin: 12px 0;\n    border-radius: 8px;\n    overflow: hidden;\n    background: var(--chat-widget-code-bg);\n  }\n\n  .chat-widget-code-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 12px;\n    background: rgba(255, 255, 255, 0.05);\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .chat-widget-code-lang {\n    font-size: 12px;\n    color: var(--chat-widget-code-text);\n    opacity: 0.7;\n    text-transform: uppercase;\n  }\n\n  .chat-widget-code-copy {\n    background: transparent;\n    border: none;\n    color: var(--chat-widget-code-text);\n    opacity: 0.7;\n    cursor: pointer;\n    padding: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    transition: opacity 0.2s ease, background 0.2s ease;\n  }\n\n  .chat-widget-code-copy:hover {\n    opacity: 1;\n    background: rgba(255, 255, 255, 0.1);\n  }\n\n  .chat-widget-code-copy--success {\n    color: #10b981;\n    opacity: 1;\n  }\n\n  .chat-widget-code-block pre {\n    margin: 0;\n    padding: 12px;\n    overflow-x: auto;\n  }\n\n  .chat-widget-code-block code {\n    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;\n    font-size: 13px;\n    line-height: 1.5;\n    color: var(--chat-widget-code-text);\n  }\n\n  /* Syntax highlighting */\n  .chat-widget-hl-keyword { color: #c678dd; }\n  .chat-widget-hl-string { color: #98c379; }\n  .chat-widget-hl-number { color: #d19a66; }\n  .chat-widget-hl-comment { color: #5c6370; font-style: italic; }\n  .chat-widget-hl-type { color: #e5c07b; }\n  .chat-widget-hl-builtin { color: #61afef; }\n\n  /* Task lists */\n  .chat-widget-task-item {\n    list-style: none;\n    margin-left: -20px;\n  }\n\n  .chat-widget-checkbox {\n    margin-right: 8px;\n    font-size: 1.1em;\n  }\n\n  .chat-widget-checkbox--checked {\n    color: var(--chat-widget-primary);\n  }\n\n  /* Plain text */\n  .chat-widget-plaintext {\n    white-space: pre-wrap;\n    word-wrap: break-word;\n  }\n\n  /* ============================================\n     Panel Error\n     ============================================ */\n  .chat-widget-panel__error {\n    padding: 12px 20px;\n    background: #fef2f2;\n    border-bottom: 1px solid #fecaca;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n\n  .chat-widget-panel__error p {\n    color: #991b1b;\n    font-size: 14px;\n    margin: 0;\n  }\n\n  .chat-widget-panel__error-dismiss {\n    background: transparent;\n    border: 1px solid #fca5a5;\n    color: #991b1b;\n    padding: 4px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 13px;\n  }\n\n  .chat-widget-panel__error-dismiss:hover {\n    background: #fee2e2;\n  }\n`;\n\n/**\n * Generate complete CSS with config values\n *\n * Variables are applied to .chat-widget-root (not :root) because\n * we're inside a Shadow DOM where :root refers to the document,\n * not the shadow root.\n */\nexport function generateStyles(config: ChatWidgetConfig): string {\n  const variables = generateCSSVariables(config);\n  return `\n    .chat-widget-root {\n      ${variables}\n    }\n    ${baseStyles}\n  `;\n}\n"],
  "mappings": "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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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",
  "names": ["escape", "html", "link", "lexer", "options", "list", "tag", "text", "parser", "tokens", "args", "ret", "walkTokens", "parse", "src", "options", "html", "tag", "options", "CLOSE_ICON", "options", "options"]
}
